var P2=function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DFS=function t(e,s){e.map(e=>{"group"===e.type()||"composite"===e.type()?(s(e),t(e.getShapeList(),s)):s(e)})},e.calcCenter=function(t){return[]},e.rotate=function(t,e,s){t.translate(e[0],e[1]),t.rotate(s/180*Math.PI),t.translate(-e[0],-e[1])},e.isInShape=function(t,e,s){}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(12);e.shapeConfig=class{};class o{constructor(t,e){this._id=Symbol(),this._type=e,this._isShow=!0,this._isMount=!1,this.event={},this.count=1,this._mounted=void 0!==t?t.mounted:()=>{},this._removed=void 0!==t?t.removed:()=>{};for(let e in t)if(/^on./g.test(e)){let s=e.toLowerCase().substring(2);this.bind(s,t[e])}}id(){return this._id}type(){return this._type}isMount(t){if(void 0===t||"boolean"!=typeof t)return this._isMount;this._isMount=t,t?this.mounted():this.removed(),"group"!==this.type()&&"composite"!==this.type()||i.DFS(this.getShapeList(),e=>{e.isMount(t),t?e.mounted():e.removed()})}show(t){return void 0!==t&&"boolean"==typeof t?(this._isShow=t,"group"!==this.type()&&"composite"!==this.type()||i.DFS(this.getShapeList(),e=>{e.show(t)}),this._isMount&&n.default.notify("update"),this):this._isShow}getShapeList(){return null}config(){}getCount(){return this.count}bind(t,e){this.event[t]=e}mounted(){for(let t in this.event)n.default.notify("event",{shape:this,eventName:t,fn:this.event[t]});this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}draw(t){}}e.Base=o;e.Shape=class extends o{constructor(t,e){super(t,e),this._x=t.pin[0],this._y=t.pin[1],this._color=t.color,this._fill=void 0===t.fill||t.fill,this._rotate=t.rotate||0}x(t){return void 0!==t&&"number"==typeof t?(this._x=t,this._isMount&&n.default.notify("update"),this):this._x}y(t){return void 0!==t&&"number"==typeof t?(this._y=t,this._isMount&&n.default.notify("update"),this):this._y}color(t){return void 0!==t&&"string"==typeof t?(this._color=t,this._isMount&&n.default.notify("update"),this):this._color}fill(t){return void 0!==t&&"boolean"==typeof t?(this._fill=t,this._isMount&&n.default.notify("update"),this):this._fill}rotate(t){return void 0!==t&&"number"==typeof t?(this._rotate=t,this._isMount&&n.default.notify("update"),this):this._rotate}getBaseConfig(){return{pin:[this._x,this._y],color:this._color,fill:this._fill,rotate:this._rotate}}animate(t){}start(t){}end(t){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(12),o=s(4),h=s(6),r=s(7),a=s(8),u=s(9),c=s(10);e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.count=0,this.ctx=t,this.canvasInfo=e,this.aSyncUpdateRequestCount=0,this.updateRequestCount=0}getCount(){return this.count}append(t){this.shapeHeapArray.push(t),t.isMount(!0),this.count+=t.getCount(),n.default.notify("update")}remove(t){let e=t.id();this.shapeHeapArray.map((t,s)=>{t.id()===e&&this.shapeHeapArray.splice(s,1)}),t.isMount(!1),this.count-=t.getCount(),n.default.notify("update")}clone(t){if("group"===t.type()){let s=new e.shapes.Group(t.config());return i.DFS(t.getShapeList(),t=>{s.append(this.clone(t))}),s}if("composite"===t.type()){let s=new e.shapes.Composite(t.config());return i.DFS(t.getShapeList(),t=>{s.join(this.clone(t))}),s}return new(e.shapes[t.type()])(t.config())}clear(){i.DFS(this.shapeHeapArray,t=>{t.isMount(!1)}),this.shapeHeapArray=[],this.count=0,this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height)}update(){this.updateRequestCount++,setTimeout(function(){this.aSyncUpdateRequestCount++,this.aSyncUpdateRequestCount===this.updateRequestCount&&(console.log("申请更新次数："+this.notifyCount),this.updateRequestCount=this.aSyncUpdateRequestCount=0,this.reRender())}.bind(this),0)}reRender(){this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height),this.shapeHeapArray.map(t=>{t.show()&&(this.ctx.save(),t.draw(this.ctx),this.ctx.restore())})}},e.shapes={Custom:o.Custom,Circle:r.Circle,Rectangle:a.Rectangle,Triangle:h.Triangle,Group:u.Group,Composite:c.Composite},e.utils={isInShape:i.isInShape}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(2),o=s(12),h=s(11);e.default=function(t,e){class s{constructor(t,e){this.ele=null,this.config={width:400,height:400,backgroundColor:"#eee"},this.ele=t,this.config=e||this.config,this.setWidth().setHeight().setBackgroundColor()}setWidth(){let t="fullWidth"===this.config.width?e.body.clientWidth:this.config.width;return this.ele.setAttribute("width",t.toString()),this.width=parseInt(t.toString()),this}setHeight(){let t="fullHeight"===this.config.height?e.body.clientHeight:this.config.height;return this.ele.setAttribute("height",t.toString()),this.height=parseInt(t.toString()),this}setBackgroundColor(){return this.ele.style.backgroundColor=this.config.backgroundColor,this}}return class{constructor(t,e){this.canvasEle=t,this.ctx=t.getContext("2d"),this.canvasStyle=new s(this.canvasEle,e),this.shapeHeap=new n.shapeHeap(this.ctx,{width:this.getWidth(),height:this.getHeight()}),this.eventSystem=new h.EventSystem(this.canvasEle),o.default.addListener("update",this.shapeHeap.update.bind(this.shapeHeap)),o.default.addListener("event",this.eventSystem.addEvent.bind(this.eventSystem)),this.shapes=i.shapes,this.utils=i.utils}getHeight(){return this.canvasStyle.height}getWidth(){return this.canvasStyle.width}getShapesCount(){return this.shapeHeap.getCount()}append(t){t instanceof Array?t.map(t=>this.shapeHeap.append(t)):this.shapeHeap.append(t)}remove(t){this.shapeHeap.remove(t)}clear(){this.shapeHeap.clear()}clone(t){return this.shapeHeap.clone(t)}}}(window,document)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(5),o=s(0);e.Custom=class extends i.Shape{constructor(t){super(t,"custom"),this.center=t.center,this._draw=t.draw}config(){return Object.assign({},this.getBaseConfig(),{center:this.center,draw:this._draw})}draw(t){o.rotate(t,[this.center[0],this.center[1]],this._rotate),this._draw(t,n.line.init(t,this))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.line=new class{constructor(){}init(t,e){return this.ctx=t,this.oX=e.x(),this.oY=e.y(),this.color=e.color(),this.fill=e.fill(),this}start(t){return this.endX=t[0],this.endY=t[1],this.ctx.translate(this.oX,this.oY),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.moveTo(this.endX,this.endY),this}bee(t){for(let e=0;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,s){this.ctx.moveTo(this.endX,this.endY),this.ctx.bezierCurveTo(t[0],t[1],e[0],e[1],s[0],s[1]),this.endX=s[0],this.endY=s[1]}arc(t,e,s,i=!0){let n,o;return n=this.endX-t*Math.cos((360-e)/180*Math.PI),o=this.endY+t*Math.sin((360-e)/180*Math.PI),this.ctx.arc(n,o,t,e/180*Math.PI,s/180*Math.PI,i),this.endX=n-t*Math.cos((360-s)/180*Math.PI),this.endY=o+t*Math.sin((360-s)/180*Math.PI),this}end(){this.fill?this.ctx.fill():this.ctx.stroke()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(12);e.Triangle=class extends i.Shape{constructor(t){super(t,"triangle"),this._edge=t.edge}config(){return Object.assign({},this.getBaseConfig(),{edge:this._edge})}edge(t){return void 0!==t&&"number"==typeof t?(this._edge=t,this._isMount&&o.default.notify("update"),this):this._edge}draw(t){let e=this._edge/2,s=Math.sqrt(this._edge*this._edge-e*e);n.rotate(t,[this._x,this._y+s/2],this._rotate),t.beginPath(),t.moveTo(this._x,this._y),t.lineTo(this._x-e,this._y+s),t.lineTo(this._x+e,this._y+s),this._fill?(t.fillStyle=this._color,t.fill()):(t.strokeStyle=this._color,t.closePath(),t.stroke())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(12);e.Circle=class extends i.Shape{constructor(t){super(t,"circle"),this._radius=t.radius}radius(t){return void 0!==t&&"number"==typeof t?(this._radius=t,this._isMount&&n.default.notify("update"),this):this._radius}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius})}draw(t){t.beginPath(),t.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this._fill?(t.fillStyle=this._color,t.fill()):(t.strokeStyle=this._color,t.stroke())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(12);e.Rectangle=class extends i.Shape{constructor(t){super(t,"rectangle"),this._width=t.edge[0],this._height=t.edge[1]}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height]})}width(t){return void 0!==t&&"number"==typeof t?(this._width=t,this._isMount&&o.default.notify("update"),this):this._width}height(t){return void 0!==t&&"number"==typeof t?(this._height=t,this._isMount&&o.default.notify("update"),this):this._height}draw(t){n.rotate(t,[this._x+this._width/2,this._y+this._height/2],this._rotate),this._fill?(t.fillStyle=this._color,t.fillRect(this._x,this._y,this._width,this._height)):(t.strokeStyle=this._color,t.strokeRect(this._x,this._y,this._width,this._height))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(12);e.Group=class extends i.Base{constructor(t){super(t,"group"),this.count=0,this.shapeList=new Array}config(){return{mounted:this._mounted,removed:this._removed}}getShapeList(){return this.shapeList}append(t){this.shapeList.push(t),"group"===t.type()?this.count+=t.getCount():this.count+=1,this._isMount&&n.default.notify("update")}remove(t){let e=t.id();this.shapeList.map((t,s)=>{t.id()===e&&this.shapeList.splice(s,1)}),"group"===t.type()?this.count-=t.getCount():this.count-=1,this._isMount&&n.default.notify("update")}render(t,e){e.map(e=>{e.show()&&("group"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore()))})}draw(t){this.render(t,this.shapeList)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(12);e.Composite=class extends i.Base{constructor(t){super(t,"composite"),this._x=t.pin[0],this._y=t.pin[1],this._rotate=t.rotate||0,this.center=t.center,this.shapeList=[]}config(){return{pin:[this._x,this._y],rotate:this._rotate,center:this.center,mounted:this._mounted,removed:this._removed}}x(t){if(void 0!==t&&"number"==typeof t){let e=t-this._x;return this._x=t,this.shapeList.map(t=>{t.x(t.x()+e)}),this._isMount&&o.default.notify("update"),this}return this._x}y(t){if(void 0!==t&&"number"==typeof t){let e=t-this._y;return this._y=t,this.shapeList.map(t=>{t.y(t.y()+e)}),this._isMount&&o.default.notify("UPDATE"),this}return this._y}getShapeList(){return this.shapeList}join(t){"group"!==t.type()?(this.shapeList.push(t),this._isMount&&o.default.notify("update")):console.warn("group类型不能加入composite")}render(t,e){this.shapeList.map(e=>{e.show()&&("composite"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore()))})}draw(t){n.rotate(t,[this.center[0],this.center[1]],this._rotate),this.render(t,this.shapeList)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.bindInfo=class{};e.keyBoardEvent=class{};e.event=class{};e.EventSystem=class{constructor(t){this.eventList=["click","mouseover","mouseout","mousemove","mousedown","mouseup"],this.canvasEle=t,this.clickEventList=[],this.mouseoverEventList=[],this.mouseoutEventList=[],this.mousemoveEventList=[],this.mousedownEventList=[],this.mouseupEventList=[],this.keypressEventMap={},this.init(this.canvasEle)}init(t){this.eventList.map(e=>{"keypress"===e?t.addEventListener("keydown",t=>{this[e+"EventMap"][t.keyCode].map(t=>{t.fn.fn({curShape:t.shape,x:0,y:0})})}):t.addEventListener(e,t=>{this[e+"EventList"].map(t=>{t.fn({curShape:t.shape,x:0,y:0})})})})}addEvent(t){"keypress"===t.eventName?(void 0===this.keypressEventMap[t.fn.keyCode]&&(this.keypressEventMap[t.fn.keyCode]=[]),this.keypressEventMap[t.fn.keyCode].push(t)):this[t.eventName+"EventList"].push(t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={listenerTable:{},addListener(t,e){this.listenerTable[t]=e},notify(t,e){this.listenerTable[t](e)}}}]);