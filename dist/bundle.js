var P2=function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=17)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(3),r=i(22),n=i(7);class o{constructor(t,e){this._id=Symbol(),this._type=e,this._show=!t||void 0===t.show||t.show,this._tag=t&&t.tag?t.tag:"",this._zIndex=t&&t.zIndex?t.zIndex:0,this._mounted=t&&t.mounted?t.mounted:()=>{},this._removed=t&&t.removed?t.removed:()=>{},this.isMount=!1,this.count=1}initSetter(){r.default[this._type].writableProperties.map(t=>{let e=t.substring(0,1).toUpperCase()+t.substring(1);void 0===this[`setter${e}`]&&(this[`setter${e}`]=function(e){this[`_${t}`]=e,r.default[this._type].notRePathProperties.includes(t)||this.createPath(!0)})})}attr(t,e){return r.default[this._type].readableProperties.includes(t)?void 0!==e?(r.default[this._type].writableProperties.includes(t)?(this[`setter${t.substring(0,1).toUpperCase()+t.substring(1)}`](e),this.isMount&&a.default.notify("update",this._zIndex)):console.warn(`${t}不能被修改`),this):this[`_${t}`]:(console.warn(`${t}属性不存在`),this)}toggleMount(t){this.isMount=t,t?this.mounted():this.removed(),"Group"!==this._type&&"Composite"!==this._type||this.getShapeList().map(e=>{e.toggleMount(t)})}getCount(){return this.count}getShapeList(){throw"此方法必须由子类重写"}config(){throw"此方法必须由子类重写"}mounted(){this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}}e.Base=o;e.shapeConfig=class{};e.Shape=class extends o{constructor(t,e){super(t,e),r.default[e].requiredProperties.map(i=>{if(void 0===t[i])throw`${i}为${e}的必填属性`}),this._x=t.pin?t.pin[0]:0,this._y=t.pin?t.pin[1]:0,this._color=t.color||"#000",this._fill=void 0===t.fill||t.fill,this._lineWidth=t.lineWidth||1,this._opacity=t.opacity||1,this._rotate=t.rotate||0,this._scale=t.scale||[1,1],this._rotate>=360&&(this._rotate%=360),this.lastX=this._x,this.lastY=this._y,this.lastRotate=0,this.lastScale=[1,1],this.mouseIn=!1,this.eventList=[],this.camelCaseEventName={},this.rePathRequestCount=0,this.aSyncRePathRequestCount=0;for(let e in t)/^on./g.test(e)&&(this.camelCaseEventName[e]=t[e],this.bind(e.toLowerCase().substring(2),t[e]))}getBaseConfig(){return Object.assign({pin:[this._x,this._y],center:this._center,color:this._color,fill:this._fill,rotate:this._rotate,scale:this._scale,zIndex:this._zIndex,tag:this._tag},this.camelCaseEventName,{mounted:this._mounted,removed:this._removed})}isMouseIn(t){if(void 0===t)return this.mouseIn;this.mouseIn=t}getPath(){return this.path}setPath(t){this.path=t}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.transformPath()}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.transformPath()}setterRotate(t){t>=360&&(t%=360),this._rotate=t,this.transformPath()}setterScale(t){this._scale=t,this.transformPath()}setterZIndex(t){t!==this._zIndex&&(a.default.notify("remove",{shape:this,zIndex:this._zIndex}),a.default.notify("append",{shape:this,zIndex:t}),this._zIndex=t)}addEvent(t){t.map(t=>{t.fn instanceof Array?t.fn.map(e=>{a.default.notify("add_event",{shape:this,eventName:t.eventName,fn:e,zIndex:this._zIndex})}):a.default.notify("add_event",{shape:this,eventName:t.eventName,fn:t.fn,zIndex:this._zIndex})})}delEvent(t){t.map(t=>{"keypress"===t.eventName?a.default.notify("del_event",{shape:this,eventName:t.eventName,keyCode:t.keyCode}):a.default.notify("del_event",{shape:this,eventName:t.eventName})})}bind(t,e){"keypress"===t?e instanceof Array?e.map(t=>t.fn=t.fn.bind(this)):e.fn=e.fn.bind(this):e=e.bind(this),this.isMount&&this.addEvent([{eventName:t,fn:e}]),this.eventList.push({eventName:t,fn:e})}unbind(t,e){"keypress"===t?this.delEvent([{eventName:t,keyCode:e}]):this.delEvent([{eventName:t}])}getEventList(){return this.eventList}animateTo(t,e){let i=[],s=this;for(let e in t.target)r.default[s._type].animateProperties.includes(e)?i.push([s["_"+e],t.target[e]]):delete t.target[e];let a=new n.default({value:i,duration:t.duration,delay:t.delay,timingFunction:t.timingFunction,render:function(){let e=0;for(let i in t.target)s.attr(i,arguments[e++])}}).final(e);t.loop?a.loop():a.start()}mounted(){this.addEvent(this.eventList),this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this.delEvent(this.eventList),this._removed&&"function"==typeof this._removed&&this._removed()}createPath(t=!1){this.drawPath().transformPath(t)}transformPath(t=!1){t?(this.rePathRequestCount++,requestAnimationFrame(()=>{this.aSyncRePathRequestCount++,this.aSyncRePathRequestCount===this.rePathRequestCount&&(this.rePathRequestCount=this.aSyncRePathRequestCount=0,this.translatePath().rotatePath().scalePath())})):this.translatePath().rotatePath().scalePath()}drawPath(){return this}translatePath(){if(this.lastX===this._x&&this.lastY===this._y)return this;let t=new Path2D;return t.addPath(this.path,s.translate([this._x-this.lastX,this._y-this.lastY])),this.path=t,this.lastX=this._x,this.lastY=this._y,this}rotatePath(){if(this._rotate===this.lastRotate)return this;let t=new Path2D;return t.addPath(this.path,s.rotate(this._center,this._rotate-this.lastRotate)),this.path=t,this.lastRotate=this._rotate,this}scalePath(){if(this._scale.toString()===this.lastScale.toString())return this;let t=new Path2D,e=[this._scale[0]/this.lastScale[0],this._scale[1]/this.lastScale[1]];return t.addPath(this.path,s.scale(this._center,e)),this.path=t,this.lastScale=this._scale,this}render(t){this._show&&(t.globalAlpha=this._opacity,this._fill?(t.fillStyle=this._color,t.fill(this.path)):(t.lineWidth=this._lineWidth,t.strokeStyle=this._color,t.stroke(this.path)))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(13),a=i(8),r=i(2);function n(t,e,i=!0){t.map(t=>{"Group"===t.attr("type")||"Composite"===t.attr("type")?(i&&e(t),n(t.getShapeList(),e)):e(t)})}function o(t){t[t.length-1]&&t[0].toString()!==t[t.length-1].toString()&&t.push(t[0])}function h(t){return t.map(t=>Array.isArray(t)?h(t):t)}function c(t){let e,i,s=!1;for(let a=1,n=t.length;a<n-1;a++){let n=[t[a][0]-t[a-1][0],t[a][1]-t[a-1][1]],o=[t[a+1][0]-t[a][0],t[a+1][1]-t[a][1]];if(i=r.Vector.cor(n,o)>=0?1:-1,void 0!==e&&e!==i){s=!0;break}e=i}return s}e.DFS=n,e.closePolyVex=o,e.calcPolyRange=function(t,e,i){let s=t[0][0],a=t[0][1],r=t[0][0],n=t[0][1];return t.map(t=>{t[0]<r&&(r=t[0]),t[0]>s&&(s=t[0]),t[1]<n&&(n=t[1]),t[1]>a&&(a=t[1])}),[[e+r,e+s],[i+n,i+a]]},e.translate=function(t){return a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.TranslateMatrix},e.rotate=function(t,e){let i=e/180*Math.PI;return a.Matrix.init(a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.Matrix.set(a.RotateMatrix,[[Math.cos(i),-1*Math.sin(i),0],[Math.sin(i),Math.cos(i),0]]),a.Matrix.mul(a.TranslateMatrix,a.RotateMatrix,a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,-t[0]],[0,1,-t[1]]]),a.Matrix.mul(a.ResultMatrix,a.TranslateMatrix,a.ResultMatrix),a.ResultMatrix},e.scale=function(t,e){return a.Matrix.init(a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.Matrix.set(a.ScaleMatrix,[[e[0],0,0],[0,e[1],0]]),a.Matrix.mul(a.TranslateMatrix,a.ScaleMatrix,a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,-t[0]],[0,1,-t[1]]]),a.Matrix.mul(a.ResultMatrix,a.TranslateMatrix,a.ResultMatrix),a.ResultMatrix},e.rotateVex=function(t,e,i){let s=i/180*Math.PI;return t.map(t=>[(t[0]-e[0])*Math.cos(s)-(t[1]-e[1])*Math.sin(s)+e[0],(t[1]-e[1])*Math.cos(s)+(t[0]-e[0])*Math.sin(s)+e[1]])},e.arrayDeepCopy=h,e.isInShape=function(t,e,i,a){if(e instanceof s.Composite){let s=!1;return n(e.getShapeList(),e=>{t.isPointInPath(e.getPath(),i,a)&&(s=!0)},!1),s}return t.isPointInPath(e.getPath(),i,a)},e.isInPath=function(t,e,i,a){if(e instanceof s.Composite){let s=!1;return n(e.getShapeList(),e=>{t.isPointInStroke(e.getPath(),i,a)&&(s=!0)},!1),s}return t.isPointInStroke(e.getPath(),i,a)},e.isConcavePoly=c,e.divideConcavePoly=function t(e){let i,s,a=[],n=e.length,l=!1,u=h(e),d=[];for(i=0,n=e.length;i<n-2;i++){let t=[e[i+1][0]-e[i][0],e[i+1][1]-e[i][1]],a=[e[i+2][0]-e[i][0],e[i+2][1]-e[i][1]];if(r.Vector.cor(t,a)<0){for(s=i+3;s<n;s++)if(a=[e[s][0]-e[i][0],e[s][1]-e[i][1]],r.Vector.cor(t,a)>0){l=!0;break}if(l)break}}let p=u[i+1],f=u[s];return(d=u.splice(i+2,s-(i+2))).unshift(p),d.push(f),o(d),a.push(u),a.push(d),c(u)&&(a=a.concat(t(u))),c(d)&&(a=a.concat(t(d))),a},e.isOverlaps=function(t,e){return t[1]>e[0]&&t[0]<e[1]||e[1]>t[0]&&e[0]<t[1]},e.getOverlapsLength=function(t,e){return t[1]>e[1]?e[1]-t[0]:t[1]-e[0]},e.getRandomColor=function(){return"rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(10*Math.random())+")"},e.isPointInPoly=function(t,e){let i,s,a,r=!1;for(i=0,s=(a=t.length)-1;i<a;s=i++)t[i][1]>e[1]!=t[s][1]>e[1]&&e[0]<(t[s][0]-t[i][0])*(e[1]-t[i][1])/(t[s][1]-t[i][1])+t[i][0]&&(r=!r);return r},e.findProjectionPoint=function(t,e){let i=[],s=t[0],a=t[0][0]===t[1][0]?NaN:(t[0][1]-t[1][1])/(t[0][0]-t[1][0]);return 0==a?(i[0]=e[0],i[1]=s[1]):isNaN(a)?(i[0]=s[0],i[1]=e[1]):(i[0]=(a*s[0]+e[0]/a+e[1]-s[1])/(1/a+a),i[1]=-1/a*(i[0]-e[0])+e[1]),i},e.findMidPoint=function(t){if(0===t.length)return null;if(1===t.length)return t[0];let e=t[0],i=t[1];return[.5*(e[0]+i[0]),.5*(e[1]+i[1])]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector={add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],dot:(t,e)=>t[0]*e[0]+t[1]*e[1],cor:(t,e)=>t[0]*e[1]-e[0]*t[1],pro(t,e){return this.dot(t,e)/this.len(e)},nor:t=>[t[1],-t[0]],len:t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),nol(t){let e=this.len(t);return 0!==e?[t[0]/e,t[1]/e]:[0,0]},scl:(t,e)=>[t*e[0],t*e[1]],inv:t=>[-t[0],-t[1]],eql:(t,e)=>t[0]===e[0]&&t[1]===e[1]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={listenerTable:{},addListener(t,e){this.listenerTable[t]=e},notify(t,...e){return this.listenerTable[t].apply(null,e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),a=i(6),r=i(1),n=i(2);var o;!function(t){t.convex="convex",t.concave="concave"}(o=e.polygonType||(e.polygonType={}));e.PolygonBody=class extends a.Body{constructor(t,e){if(super(t,e||"Polygon"),e&&"Polygon"!==e)return;let i=this.shape.attr("x"),s=this.shape.attr("y");this.baseVex=this.shape.attr("vex"),this.vex=this.baseVex.map(t=>[i+t[0],s+t[1]]),0!=this.rot&&(this.vex=r.rotateVex(this.vex,this.pos,this.rot)),r.closePolyVex(this.vex),this.polygonType=r.isConcavePoly(this.vex)?o.concave:o.convex,this.polygonType===o.concave?this.convexPolyList=r.divideConcavePoly(this.vex):this.convexPolyList=[],this.area=this.calcArea(),this.mass=this.mass||this.area*this.density,this.centroid=this.calcCentroid(),this.rotationInertia=this.calcRotationInertia(),this.static===a.staticType.position||this.static===a.staticType.total?this.inverseMass=0:this.inverseMass=1/this.mass,this.boundRect=this.createBoundRect()}calcArea(){let t=0,e=[0,0],i=this.vex.length-1;for(let s=0;s<i;++s){let a=e,r=this.vex[s],o=s+1<i?this.vex[s+1]:this.vex[0],h=n.Vector.sub(r,a),c=n.Vector.sub(o,a);t+=.5*n.Vector.cor(h,c)}return t}calcDensity(){return this.mass/this.area}calcCentroid(){let t=[0,0],e=[0,0],i=this.vex.length,s=0;for(let a=0;a<i-1;++a){let i=e,r=this.vex[a],o=this.vex[a+1],h=n.Vector.sub(r,i),c=n.Vector.sub(o,i),l=.5*n.Vector.cor(h,c),u=n.Vector.scl(1/3,n.Vector.add(n.Vector.add(i,r),o));s+=l,t=n.Vector.add(t,n.Vector.scl(l,u))}return t=n.Vector.scl(1/s,t)}calcRotationInertia(){let t=0,e=[0,0],i=this.vex.length;for(let s=0;s<i-1;++s){let i=e,a=this.vex[s],r=this.vex[s+1],o=n.Vector.sub(a,i),h=n.Vector.sub(r,i),c=n.Vector.cor(o,h),l=i[0],u=i[1],d=o[0],p=o[1],f=h[0],g=h[1];t+=c*(1/3*(.25*(d*d+f*d+f*f)+(l*d+l*f))+.5*l*l+(1/3*(.25*(p*p+g*p+g*g)+(u*p+u*g))+.5*u*u))}return t=this.density*(t-this.area*n.Vector.dot(this.centroid,this.centroid))}createBoundRect(){return new s.default(r.calcPolyRange(this.vex,0,0))}updateBoundRect(t){if("pos"===t.type){let e=t.val[0],i=t.val[1];this.vex=this.vex.map(t=>[e+t[0],i+t[1]]),this.centroid[0]=this.centroid[0]+e,this.centroid[1]=this.centroid[1]+i}else this.vex=r.rotateVex(this.vex,this.pos,t.val),this.centroid=r.rotateVex([this.centroid],this.pos,t.val)[0];this.polygonType===o.concave&&(this.convexPolyList=r.divideConcavePoly(this.vex)),this.boundRect.update(r.calcPolyRange(this.vex,0,0))}getPolyType(){return this.polygonType}getConvexPolyList(){return this.convexPolyList}getInfo(){return this.vex}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8);e.drawTool=new class{constructor(){}init(t,e){return this.path=t,this.oX=e[0],this.oY=e[1],this.endX=this.oX,this.endY=this.oY,this.tPath=new Path2D,s.Matrix.set(s.TranslateMatrix,[[1,0,this.oX],[0,1,this.oY]]),this.tPath.moveTo(0,0),this}bee(t){for(let e=0;e<t.length;e++)this.tPath.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,i){this.tPath.moveTo(this.endX,this.endY),this.tPath.bezierCurveTo(t[0],t[1],e[0],e[1],i[0],i[1]),this.endX=i[0],this.endY=i[1]}arc(t,e,i,s=!0){let a,r;return a=this.endX-t*Math.cos((360-e)/180*Math.PI),r=this.endY+t*Math.sin((360-e)/180*Math.PI),this.tPath.arc(a,r,t,e/180*Math.PI,i/180*Math.PI,s),this.endX=a-t*Math.cos((360-i)/180*Math.PI),this.endY=r+t*Math.sin((360-i)/180*Math.PI),this}move(t,e){this.tPath.moveTo(t,e),this.endX=t,this.endY=e}end(t=!0){t&&this.tPath.closePath(),this.path.addPath(this.tPath,s.TranslateMatrix),s.Matrix.init(s.TranslateMatrix)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),a=i(20),r=i(3),n=i(12);var o;!function(t){t.none="none",t.position="pos",t.total="total"}(e.staticType||(e.staticType={}));e.Nature=class{},function(t){t[t.init=0]="init",t[t.simulate=1]="simulate",t[t.sleep=2]="sleep"}(o=e.state||(e.state={}));e.BodyConfig=class{};e.Body=class{constructor(t,e){this.shape=r.default.notify("createShape",e,t.shape),this.id=this.shape.attr("id"),this.initPhysicalData(t),this.force=new a.default(this)}initPhysicalData(t){this.pos=this.shape.attr("center"),this.rot=this.shape.attr("rotate"),this.linearAcc=[0,0],this.linearVel=[0,0],this.angularVel=0,this.angularAcc=0,this.mass=0,this.inverseMass=-1,this.friction=0,this.restitution=.7,this.area=0,this.density=.01,this.centroid=[0,0],this.rotationInertia=0,this.torque=0,this.static="none",this.state=o.init,this.isCollide=!1,this.lastFrameLVel=this.linearVel,this.lastFrameAvel=this.angularVel,this.lastPos=this.pos,t.nature&&(this.linearVel=t.nature.linearVelocity||this.linearVel,this.angularVel=t.nature.angularVelocity||this.angularVel,this.static=t.nature.static||"none",this.friction=t.nature.friction||this.friction,this.restitution=t.nature.restitution||this.restitution,this.mass=t.nature.mass||this.mass),this.collidedFn=t.collided||(()=>{}),this.separatedFn=t.separated||(()=>{})}initBodyData(){throw"此方法必须由子类重写"}calcArea(){throw"此方法必须由子类重写"}calcDensity(){throw"此方法必须由子类重写"}calcCentroid(){throw"此方法必须由子类重写"}calcRotationInertia(){throw"此方法必须由子类重写"}getShape(){return this.shape}getInfo(){throw"此方法必须由子类重写"}getId(){return this.id}bind(t,e){this.shape.bind(t,e)}createBoundRect(){throw"此方法必须由子类重写"}updateBoundRect(t){throw"此方法必须由子类重写"}getBoundRect(){return this.boundRect}integratePosition(){this.linearVel=s.Vector.add(this.linearVel,this.linearAcc),this.setPos(s.Vector.add(this.linearVel,this.pos))}integrateRotation(){this.angularVel+=this.angularAcc,this.rot>=360&&(this.rot%=360),this.setRotation(this.rot+this.angularVel)}update(){this.force.applyForce(n.globalForce.gravity.generateForce(this),[0,0]),this.force.applyForce(n.globalForce.linearDrag.generateForce(this),[0,0]),this.angularVel=n.globalForce.angularDrag.generateForce(this);let t=this.force.getAccForce();this.linearAcc=t.linearAcc,this.angularAcc=t.angularAcc,this.integratePosition(),this.integrateRotation(),this.force.clearForce()}setPos(t){let e=this.shape.attr("x"),i=this.shape.attr("y"),a=s.Vector.sub(t,this.pos);this.pos=t,this.updateBoundRect({type:"pos",val:a}),this.shape.attr("x",e+a[0]).attr("y",i+a[1])}setRotation(t){let e=t-this.rot;this.rot=t,this.updateBoundRect({type:"rot",val:e}),this.shape.attr("rotate",t)}collided(t){this.collidedFn.call(this,t)}separated(){this.separatedFn.call(this)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(23),a=i(3);var r;!function(t){t[t.init=0]="init",t[t.play=1]="play",t[t.stop=2]="stop",t[t.end=3]="end",t[t.final=4]="final"}(r=e.state||(e.state={}));e.default=class{constructor(t){this.id=Symbol(),this.isLoop=!1,this.animationQueue=[],this.animationQueueIndex=0,this.animationQueue.push(t),this.init(t)}init(t){return this._value=[],this._duration=t.duration||1e3,this._delay=t.delay||0,this._timingFunction=t.timingFunction?s.default[t.timingFunction]:s.default.linear,this._renderFunction=t.render||((...t)=>{}),this._onStart=t.onStart||(()=>{}),this._onEnd=t.onEnd||(()=>{}),this._onStop=t.onStop||(()=>{}),this.state=r.init,this.initValue(t.value),this}initValue(t){t.every(t=>t instanceof Array)?t.map(t=>{this._value.push({start:t[0],end:t[1]})}):this._value.push({start:t[0],end:t[1]})}animationFrame(){let t=Date.now()-this.beginTime;t>=this._duration||this.state===r.end?(this.renderFunction(this._duration,this._duration),this.end()):this.state===r.stop?this.renderFunction(t,this._duration):this.state===r.init?this.renderFunction(0,this._duration):this.renderFunction(t,this._duration)}renderFunction(t,e){const i=this._value.map(i=>this._timingFunction(t,i.start,i.end-i.start,e));this._renderFunction.apply(this,i)}finalFunction(){this.isLoop?(this.state=r.init,this.animationQueueIndex=0,this.init(this.animationQueue[this.animationQueueIndex]).start()):this._onFinal&&this._onFinal()}start(){this.animationQueueIndex++,setTimeout(()=>{this.state=r.play,this.beginTime=Date.now(),this._onStart(),a.default.notify("animation",this)},this._delay)}loop(){this.isLoop=!0,this.start()}stop(){this.state===r.play&&(this.state=r.stop,this._onStop())}end(){this.state===r.play&&(this.state=r.end,this._onEnd(),this.animationQueueIndex<this.animationQueue.length?this.init(this.animationQueue[this.animationQueueIndex]).start():(this.state=r.final,this.finalFunction()))}final(t){return this._onFinal=t,this}next(t){return this.animationQueue.push(t),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){t&&t.length?(this.a=t[0][0],this.b=t[1][0],this.c=t[0][1],this.d=t[1][1],this.e=t[0][2],this.f=t[1][2]):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}}e.Matrix={init(t){t.a=1,t.b=0,t.c=0,t.d=1,t.e=0,t.f=0},set(t,e){t.a=e[0][0],t.b=e[1][0],t.c=e[0][1],t.d=e[1][1],t.e=e[0][2],t.f=e[1][2]},mul(t,e,i){i.a=t.a*e.a+t.c*e.b,i.b=t.b*e.a+t.d*e.b,i.c=t.a*e.c+t.c*e.d,i.d=t.b*e.c+t.d*e.d,i.e=t.a*e.e+t.c*e.f+t.e,i.f=t.b*e.e+t.d*e.f+t.f},add(t,e,i){i.a=t.a+e.a,i.b=t.b+e.b,i.c=t.c+e.c,i.d=t.d+e.d,i.e=t.e+e.e,i.f=t.f+e.f},create:t=>new s(t),createSVGMatrix(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t&&t.length&&(e.a=t[0][0],e.b=t[1][0],e.c=t[0][1],e.d=t[1][1],e.e=t[0][2],e.f=t[1][2]),e}},e.RotateMatrix=e.Matrix.createSVGMatrix(),e.ScaleMatrix=e.Matrix.createSVGMatrix(),e.TranslateMatrix=e.Matrix.createSVGMatrix(),e.ResultMatrix=e.Matrix.createSVGMatrix()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(5),r=i(1);e.polygonConfig=class extends s.shapeConfig{};e.Polygon=class extends s.Shape{constructor(t,e){if(super(t,e||"Polygon"),"Polygon"!==this._type)return;if(this._vex=t.vex,this._vex.length<3)throw"多边形定点数必须大于3.";let i=r.calcPolyRange(this._vex,this._x,this._y);this._center=[i[0][0]+(i[0][1]-i[0][0])/2,i[1][0]+(i[1][1]-i[1][0])/2],this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{vex:this._vex})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee(this._vex).end(),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),a=i(14),r=i(2),n=i(1),o=i(4);var h;function c(t,e){let i,s,a=function(t,e){let i,s;return i=Array.isArray(t)?l(t):u(t,e),s=Array.isArray(e)?l(e):u(e,t),i.concat(s)}(t,e),r=1e4,o=0,c=-1;for(let h=0;h<a.length;h++){let l=d(t,a[h]),u=d(e,a[h]);if(!n.isOverlaps(l,u))return null;(o=n.getOverlapsLength(l,u))<r&&(r=o,c=h,i=l,s=u)}return Object.assign({nor:a[c],len:r},function(t,e,i,s,a){if(Array.isArray(t)&&Array.isArray(i)){let r=p(t,a),n=p(i,a),o=f(r,s,a),c=f(n,e,a);if(o&&!c)return{edge:o,type:h.e2a,p:g(h.e2a,o,t,i)};if(!o&&c)return{edge:c,type:h.e2a,p:g(h.e2a,c,i,t)};if(o&&c)return{edge:o,type:h.e2e,p:g(h.e2e,o,t,i)};if(!o&&!c)return{edge:null,type:h.a2a,p:null}}if(Array.isArray(t)&&!Array.isArray(i)){let e=p(t,a),r=f(e,s,a);return r?{edge:r,type:h.e2c,p:g(h.e2c,r,t,i)}:{edge:r,type:h.a2c,p:null}}if(!Array.isArray(t)&&Array.isArray(i)){let s=p(i,a),r=f(s,e,a);return r?{edge:r,type:h.e2c,p:g(h.e2c,r,i,t)}:{edge:r,type:h.a2c,p:null}}return null}(t,i,e,s,a[c]))}function l(t){let e=[];for(let i=1,s=t.length;i<s;i++)e.push(r.Vector.nor([t[i][0]-t[i-1][0],t[i][1]-t[i-1][1]]));return e}function u(t,e){let i,s=0;return i=r.Vector.len([e[0][0]-t.x,e[0][1]-t.y]),e.map((e,a)=>{let n=r.Vector.len([e[0]-t.x,e[1]-t.y]);n<i&&(i=n,s=a)}),[[e[s][0]-t.x,e[s][1]-t.y]]}function d(t,e){let i;if(Array.isArray(t)){let s=t.map(t=>r.Vector.pro(t,e));i=[Math.min.apply(Math,s),Math.max.apply(Math,s)]}else{let s=r.Vector.pro([t.x,t.y],e);i=[s-t.radius,s+t.radius]}return i}!function(t){t[t.e2e=0]="e2e",t[t.e2a=1]="e2a",t[t.a2a=2]="a2a",t[t.e2c=3]="e2c",t[t.a2c=4]="a2c",t[t.c2c=5]="c2c",t[t.p2b=6]="p2b",t[t.c2b=7]="c2b"}(h=e.collisionType||(e.collisionType={})),e.default=function(t,e){if(t instanceof o.PolygonBody&&e instanceof o.PolygonBody){if(t.getPolyType()===s.polygonType.concave&&e.getPolyType()===s.polygonType.concave){let i,s,a=[];i=t.getConvexPolyList(),s=e.getConvexPolyList();for(let t=0,e=i.length;t<e;t++)for(let e=0,r=s.length;e<r;e++){let r=c(i[t],s[e]);r&&a.push(r)}return a.length?a:null}if(t.getPolyType()===s.polygonType.concave&&e.getPolyType()===s.polygonType.convex){let i=e.getInfo(),s=t.getConvexPolyList(),a=[];for(let t=0,e=s.length;t<e;t++){let e=c(s[t],i);e&&a.push(e)}return a.length?a:null}if(t.getPolyType()===s.polygonType.convex&&e.getPolyType()===s.polygonType.concave){let i=t.getInfo(),s=e.getConvexPolyList(),a=[];for(let t=0,e=s.length;t<e;t++){let e=c(s[t],i);e&&a.push(e)}return a.length?a:null}{let i=c(t.getInfo(),e.getInfo());return i?[i]:null}}if(t instanceof o.PolygonBody&&e instanceof a.CirBody){if(t.getPolyType()===s.polygonType.concave){let i=t.getConvexPolyList(),s=e.getInfo(),a=[];for(let t=0,e=i.length;t<e;t++){let e=c(i[t],s);e&&a.push(e)}return a.length?a:null}{let i=c(t.getInfo(),e.getInfo());return i?[i]:null}}if(t instanceof a.CirBody&&e instanceof o.PolygonBody){if(e.getPolyType()===s.polygonType.concave){let i=e.getConvexPolyList(),s=t.getInfo(),a=[];for(let t=0,e=i.length;t<e;t++){let e=c(i[t],s);e&&a.push(e)}return a.length?a:null}{let i=c(t.getInfo(),e.getInfo());return i?[i]:null}}{let i=function(t,e){let i=[t.getInfo().x,t.getInfo().y],s=[e.getInfo().x,e.getInfo().y],a=Math.sqrt(Math.pow(i[0]-s[0],2)+Math.pow(i[1]-s[1],2)),n=t.getInfo().radius+e.getInfo().radius;return{nor:r.Vector.sub(i,s),len:n-a,edge:null,type:h.c2c,p:null}}(t,e);return i?[i]:null}};function p(t,e){let i=[];for(let s=0,a=t.length;s<a-1;s++){let a=r.Vector.sub(t[s+1],t[s]);0===r.Vector.dot(a,e)&&i.push([t[s],t[s+1]])}return i}function f(t,e,i){if(0===t.length)return null;for(let s=0,a=t.length;s<a;s++){let a=r.Vector.pro(t[s][0],i);if(e[0]<a&&e[1]>a)return t[s]}}function g(t,e,i,s){let a=[];if(t===h.e2e){for(let t=0,r=s.length;t<r-1;t++)n.isPointInPoly(i,s[t])&&a.push(n.findProjectionPoint(e,s[t]));for(let t=0,r=i.length;t<r-1;t++)n.isPointInPoly(s,i[t])&&a.push(n.findProjectionPoint(e,i[t]));a=n.findMidPoint(a)}if(t===h.e2a){for(let t=0,r=s.length;t<r-1;t++)n.isPointInPoly(i,s[t])&&a.push(n.findProjectionPoint(e,s[t]));a=n.findMidPoint(a)}return t===h.e2c&&(a=n.findProjectionPoint(e,[s.x,s.y])),a}e.info=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.update(t)}update(t){this.hor=t[0],this.ver=t[1]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(21),a=i(2);e.Gravity=class extends s.default{constructor(t){super(t)}generateForce(t){return a.Vector.scl(.06*t.mass,this.force)}};e.LinearDrag=class extends s.default{constructor(t,e){super(),this.k1=t,this.k2=e}generateForce(t){let e=a.Vector.len(t.linearVel),i=this.k1*e+this.k2*e*e;return a.Vector.scl(-i,a.Vector.nol(t.linearVel))}};e.AngularDrag=class extends s.default{constructor(t){super(),this.k=t}generateForce(t){return t.angularVel*=1-this.k}},e.globalForce={gravity:null,linearDrag:null,angularDrag:null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(3),r=i(1);e.Composite=class extends s.Shape{constructor(t){super(t,"Composite"),this.deep=void 0===t.deep||t.deep,this._center=t.center,this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.join(t,this.deep)}),this.initSetter()}join(t,e){if(t instanceof Array)t.map(t=>this.join(t,e));else{if("Group"===t.attr("type"))return void console.warn("group类型不能加入composite");this.shapeList.push(this.shapeProcessor(e?a.default.notify("clone",t):t)),this.isMount&&a.default.notify("update")}}config(){return Object.assign({},this.getBaseConfig(),{deep:this.deep,shapes:this.shapeList})}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.shapeList.map(t=>{t.attr("x",t.attr("x")+e),this.shapeProcessor(t)})}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.shapeList.map(t=>{t.attr("y",t.attr("y")+e),this.shapeProcessor(t)})}setterShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}setterRotate(t){t>=360&&(t%=360),this._rotate=t,r.DFS(this.getShapeList(),t=>{t.transformPath()},!1),this.shapeList.map(t=>{this.rotatePath(t)})}setterScale(t){return r.DFS(this.getShapeList(),t=>{t.transformPath()},!1),this.shapeList.map(t=>{this.scalePath(t)}),this}getShapeList(){return this.shapeList}shapeProcessor(t){return this._rotate&&this.rotatePath(t),this._scale&&this.scalePath(t),t}rotatePath(t){if("Composite"===t.attr("type"))r.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),r.rotate(this._center,this._rotate)),t.setPath(e)},!1);else if("Text"===t.attr("type"))t.setCompositeRotate(this._center,this._rotate);else{let e=new Path2D;e.addPath(t.getPath(),r.rotate(this._center,this._rotate)),t.setPath(e)}return this}scalePath(t){if("Composite"===t.attr("type"))r.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),r.scale(this._center,this._scale)),t.setPath(e)},!1);else if("Text"===t.attr("type"))t.setCompositeScale(this._center,this._scale);else{let e=new Path2D;e.addPath(t.getPath(),r.scale(this._center,this._scale)),t.setPath(e)}return this}render(t){this._show&&r.DFS(this.shapeList,e=>{t.save(),e.render(t),t.restore()},!1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),a=i(11);e.circleInfo=class{};e.CirBody=class extends s.Body{constructor(t){super(t,"Circle"),this.cirInfo={x:this.pos[0],y:this.pos[1],radius:this.shape.attr("radius")},this.area=this.calcArea(),this.mass=this.mass||this.area*this.density,this.centroid=this.calcCentroid(),this.rotationInertia=this.calcRotationInertia(),this.static===s.staticType.position||this.static===s.staticType.total?this.inverseMass=0:this.inverseMass=1/this.mass,this.boundRect=this.createBoundRect()}calcArea(){return Math.pow(this.cirInfo.radius,2)*Math.PI}calcDensity(){return this.mass/this.area}calcCentroid(){return[this.pos[0],this.pos[1]]}calcRotationInertia(){return.5*this.mass*Math.pow(this.cirInfo.radius,2)}createBoundRect(){let t=[[this.cirInfo.x-this.cirInfo.radius,this.cirInfo.x+this.cirInfo.radius],[this.cirInfo.y-this.cirInfo.radius,this.cirInfo.y+this.cirInfo.radius]];return new a.default(t)}updateBoundRect(t){"pos"===t.type&&(this.cirInfo.x=t.val[0]+this.cirInfo.x,this.cirInfo.y=t.val[1]+this.cirInfo.y);let e=[[this.cirInfo.x-this.cirInfo.radius,this.cirInfo.x+this.cirInfo.radius],[this.cirInfo.y-this.cirInfo.radius,this.cirInfo.y+this.cirInfo.radius]];this.boundRect.update(e)}getInfo(){return this.cirInfo}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(25),a=i(1),r=i(40),n=i(41),o=i(16),h=i(8),c=i(2),l=i(7),u={isInShape:a.isInShape,isInPath:a.isInPath,arrayDeepCopy:a.arrayDeepCopy,divideConcavePoly:a.divideConcavePoly,isConcavePoly:a.isConcavePoly,getRandomColor:a.getRandomColor},d={Matrix:h.Matrix,Vector:c.Vector};e.default=class{constructor(t){this.container=t,this.container.style.position="relative",this.container.style.userSelect="none",this.containerLeft=t.scrollLeft+t.clientLeft,this.containerTop=t.scrollTop+t.clientTop,this.layerManager=new s.LayerManager(this.container),this.eventSystem=new n.EventSystem(this.container,this.layerManager.getLayerMap(),[this.containerLeft,this.containerTop]),this.animationManager=new r.default,this.shapes=o.default,this.utils=u,this.math=d,this.animation=l.default}getHeight(){return this.container.offsetHeight}getWidth(){return this.container.offsetWidth}getShapesCount(){return this.layerManager.getTotalCount()}bind(t,e){"keypress"===t?this.container.addEventListener("keydown",function(i){i.keyCode===t.keyCode&&e()}):this.container.addEventListener(t,function(t){let i=t.clientX-this.containerLeft,s=t.clientY-this.containerTop;e({x:i,y:s})}.bind(this))}append(t){void 0!==t&&(t instanceof Array?t.map(t=>this.layerManager.append({shape:t,zIndex:t.attr("zIndex")})):this.layerManager.append({shape:t,zIndex:t.attr("zIndex")}))}remove(t){void 0!==t&&this.layerManager.remove({shape:t,zIndex:t.attr("zIndex")})}clear(){this.layerManager.clear()}clone(t){return this.layerManager.clone(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(28),a=i(29),r=i(30),n=i(31),o=i(32),h=i(33),c=i(34),l=i(35),u=i(9),d=i(36),p=i(37),f=i(13),g=i(38),y=i(39);e.default={Custom:s.Custom,Circle:r.Circle,Rectangle:n.Rectangle,Triangle:a.Triangle,Group:p.Group,Composite:f.Composite,Ellipse:o.Ellipse,RoundRect:h.RoundRect,Sector:l.Sector,Ring:c.Ring,Polygon:u.Polygon,SVGPath:d.SVGPath,Line:y.Line,Text:g.TextBlock}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(18),a=i(15);e.World=s.default,e.Renderer=a.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(19),a=i(4),r=i(14),n=i(24),o=i(15),h=i(42),c=i(43),l=i(44),u=i(45),d=i(12),p=i(3),f=i(49);const g={Polygon:a.PolygonBody,Circle:r.CirBody,Rect:n.RectBody,Tri:f.TriBody,BoundaryTop:c.BoundaryTop,BoundaryRight:c.BoundaryRight,BoundaryBottom:c.BoundaryBottom,BoundaryLeft:c.BoundaryLeft};e.default=class{constructor(t,e){this.Renderer=new o.default(t),this.bodyHeap=new s.default,this.boundariesManager=new l.default([this.getWidth(),this.getHeight()]),this.collisionManager=new u.default(this.bodyHeap.getHeap(),this.boundariesManager),this.motion=new h.default(this.bodyHeap.getHeap(),this.collisionManager),this.body=g,this.setGlobalForce(e),p.default.addListener("createShape",this.createShape.bind(this))}setGlobalForce(t){t.gravity=t.gravity||[0,5],t.linearDrag=t.linearDrag||[.2,0],t.angularDrag=t.angularDrag||.2,d.globalForce.gravity=new d.Gravity(t.gravity),d.globalForce.linearDrag=new d.LinearDrag(t.linearDrag[0],t.linearDrag[1]),d.globalForce.angularDrag=new d.AngularDrag(t.angularDrag)}createShape(t,e){return new this.Renderer.shapes[t](e)}getWidth(){return this.Renderer.getWidth()}getHeight(){return this.Renderer.getHeight()}getBodyCount(){return this.Renderer.getShapesCount()}append(t){Array.isArray(t)?t.map(t=>this.append(t)):t instanceof c.Boundary?this.boundariesManager.add(t):(this.Renderer.append(t.getShape()),this.bodyHeap.append(t))}remove(t){t instanceof c.Boundary?this.boundariesManager.remove(t):(this.Renderer.remove(t.getShape()),this.bodyHeap.remove(t.getId()))}clear(){this.Renderer.clear(),this.bodyHeap.clear()}bind(t,e){this.Renderer.bind(t,e)}pause(){this.motion.pause()}start(){this.motion.start()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.heap=[]}getHeap(){return this.heap}append(t){this.heap.push(t)}remove(t){this.heap.map((e,i)=>{e.getId()===t&&this.heap.splice(i,1)})}clear(){this.heap=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.accelerationInfo=class{};e.default=class{constructor(t){this.body=t,this.accForce=[0,0],this.accumulateLinearAcc=[0,0],this.accumulateAngularAcc=0}getAccForce(){return{linearAcc:this.accumulateLinearAcc,angularAcc:this.accumulateAngularAcc}}applyForce(t,e){this.accumulateLinearAcc=s.Vector.add(this.accumulateLinearAcc,s.Vector.scl(this.body.inverseMass,t))}applyImpulse(t,e){this.accumulateLinearAcc=s.Vector.add(this.accumulateLinearAcc,s.Vector.scl(this.body.inverseMass,t)),this.accumulateAngularAcc+=1/this.body.rotationInertia*s.Vector.cor(e,t)/this.body.inverseMass}clearForce(){this.accumulateLinearAcc=[0,0],this.accumulateAngularAcc=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.force=t}generateForce(t){throw"此方法必须由子类重写"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={baseProp:{writableProperties:[],readonlyProperties:[],animateProperties:[],notRePathProperties:[],readableProperties:[],requiredProperties:[]},init(){return this.baseProp.writableProperties=["x","y","color","fill","opacity","rotate","scale","show","zIndex","lineWidth"],this.baseProp.readonlyProperties=["id","type","center","tag"],this.baseProp.animateProperties=["x","y","color","opacity","rotate","lineWidth"],this.baseProp.notRePathProperties=["color","fill","opacity","show","lineWidth"],this.baseProp.requiredProperties=["pin"],this.baseProp.readableProperties=[],this},handle(t,e,i){switch(t){case"add":this.add(e,i);break;case"remove":this.remove(e,i);break;case"replace":this.baseProp[e]=i}},writableProperties(t,e){return this.handle(t,"writableProperties",e),this},readonlyProperties(t,e){return this.handle(t,"readonlyProperties",e),this},animateProperties(t,e){return this.handle(t,"animateProperties",e),this},notRePathProperties(t,e){return this.handle(t,"notRePathProperties",e),this},requiredProperties(t,e){return this.handle(t,"requiredProperties",e),this},add(t,e){return Array.isArray(e)?e.map(e=>this.baseProp[t].push(e)):this.baseProp[t].push(e),this},remove(t,e){return Array.isArray(e)?e.map(e=>{this.baseProp[t].splice(this.baseProp[t].findIndex(t=>t===e),1)}):this.baseProp[t].splice(this.baseProp[t].findIndex(t=>t===e),1),this},merge:(t,e)=>t.concat(e),get(){return Object.assign({},this.baseProp,{readableProperties:this.merge(this.baseProp.readonlyProperties,this.baseProp.writableProperties)})}};e.default={Line:(()=>{let t={writableProperties:["color","opacity","show","zIndex","lineWidth","range"],readonlyProperties:["id","type","tag"],animateProperties:[],notRePathProperties:["color","opacity","show","lineWidth"],requiredProperties:["range"],readableProperties:["color","opacity","show","zIndex","lineWidth","id","type","tag","range"]};return t})(),Circle:(()=>(s.init(),s.writableProperties("add","radius"),s.animateProperties("add","radius"),s.requiredProperties("add","radius"),s.get()))(),Ring:(()=>(s.init(),s.writableProperties("add",["radius","width"]),s.animateProperties("add",["radius","width"]),s.requiredProperties("add",["radius","width"]),s.get()))(),Sector:(()=>(s.init(),s.writableProperties("add",["radius","range"]),s.animateProperties("add",["radius","range"]),s.requiredProperties("add",["radius","range"]),s.get()))(),Ellipse:(()=>(s.init(),s.writableProperties("add",["radiusX","radiusY"]),s.animateProperties("add",["radiusX","radiusY"]),s.requiredProperties("add","radius"),s.get()))(),Rectangle:(()=>(s.init(),s.writableProperties("add",["width","height"]),s.animateProperties("add",["width","height"]),s.requiredProperties("add","edge"),s.readonlyProperties("add","vex"),s.get()))(),RoundRect:(()=>(s.init(),s.writableProperties("add",["round","height","width"]),s.animateProperties("add",["round","height","width"]),s.requiredProperties("add",["round","edge"]),s.get()))(),Triangle:(()=>(s.init(),s.writableProperties("add","edge"),s.animateProperties("add","edge"),s.requiredProperties("add","edge"),s.readonlyProperties("add","vex"),s.get()))(),Polygon:(()=>(s.init(),s.writableProperties("add","vex"),s.requiredProperties("add","vex"),s.get()))(),Custom:(()=>(s.init(),s.get()))(),SVGPath:(()=>(s.init(),s.writableProperties("add","svgPath"),s.requiredProperties("add",["svgPath","center"]),s.get()))(),Text:(()=>(s.init(),s.writableProperties("add",["align","dir","content","fontSize"]),s.animateProperties("add","fontSize"),s.notRePathProperties("replace",s.merge(s.baseProp.writableProperties,s.baseProp.readonlyProperties)),s.get()))(),Composite:(()=>(s.init(),s.writableProperties("remove",["color","fill","opacity"]),s.animateProperties("remove",["color","opacity"]),s.notRePathProperties("remove",["color","fill","opacity"]),s.requiredProperties("add","center"),s.get()))(),Group:(()=>(s.init(),s.readonlyProperties("remove","center"),s.writableProperties("replace",["show"]),s.animateProperties("replace",[]),s.notRePathProperties("replace",["show"]),s.get()))()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={linear:(t,e,i,s)=>i*t/s+e,easeIn:(t,e,i,s)=>i*(t/=s)*t+e,easeOut:(t,e,i,s)=>-i*(t/=s)*(t-2)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,easeInCubic:(t,e,i,s)=>i*(t/=s)*t*t+e,easeOutCubic:(t,e,i,s)=>i*((t=t/s-1)*t*t+1)+e,easeInOutCubic:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e,easeInQuart:(t,e,i,s)=>i*(t/=s)*t*t*t+e,easeOutQuart:(t,e,i,s)=>-i*((t=t/s-1)*t*t*t-1)+e,easeInOutQuart:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e,easeInQuint:(t,e,i,s)=>i*(t/=s)*t*t*t*t+e,easeOutQuint:(t,e,i,s)=>i*((t=t/s-1)*t*t*t*t+1)+e,easeInOutQuint:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,easeInSine:(t,e,i,s)=>-i*Math.cos(t/s*(Math.PI/2))+i+e,easeOutSine:(t,e,i,s)=>i*Math.sin(t/s*(Math.PI/2))+e,easeInOutSine:(t,e,i,s)=>-i/2*(Math.cos(Math.PI*t/s)-1)+e,easeInExpo:(t,e,i,s)=>0==t?e:i*Math.pow(2,10*(t/s-1))+e,easeOutExpo:(t,e,i,s)=>t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e,easeInOutExpo:(t,e,i,s)=>0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e,easeInCirc:(t,e,i,s)=>-i*(Math.sqrt(1-(t/=s)*t)-1)+e,easeOutCirc:(t,e,i,s)=>i*Math.sqrt(1-(t=t/s-1)*t)+e,easeInOutCirc:(t,e,i,s)=>(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInElastic(t,e,i,s,a,r){let n;return 0==t?e:1==(t/=s)?e+i:(void 0===r&&(r=.3*s),!a||a<Math.abs(i)?(n=r/4,a=i):n=r/(2*Math.PI)*Math.asin(i/a),-a*Math.pow(2,10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)+e)},easeOutElastic(t,e,i,s,a,r){let n;return 0==t?e:1==(t/=s)?e+i:(void 0===r&&(r=.3*s),!a||a<Math.abs(i)?(a=i,n=r/4):n=r/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin((t*s-n)*(2*Math.PI)/r)+i+e)},easeInOutElastic(t,e,i,s,a,r){let n;return 0==t?e:2==(t/=s/2)?e+i:(void 0===r&&(r=s*(.3*1.5)),!a||a<Math.abs(i)?(a=i,n=r/4):n=r/(2*Math.PI)*Math.asin(i/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)*-.5+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*s-n)*(2*Math.PI)/r)*.5+i+e)},easeInBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),i*(t/=s)*t*((a+1)*t-a)+e),easeOutBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),i*((t=t/s-1)*t*((a+1)*t+a)+1)+e),easeInOutBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),(t/=s/2)<1?i/2*(t*t*((1+(a*=1.525))*t-a))+e:i/2*((t-=2)*t*((1+(a*=1.525))*t+a)+2)+e),easeInBounce:(t,e,i,a)=>i-s.easeOutBounce(a-t,0,i,a)+e,easeOutBounce:(t,e,i,s)=>(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,easeInOutBounce:(t,e,i,a)=>t<a/2?.5*s.easeInBounce(2*t,0,i,a)+e:.5*s.easeOutBounce(2*t-a,0,i,a)+.5*i+e};e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),a=i(6),r=i(2),n=i(1);e.RectBody=class extends s.PolygonBody{constructor(t){super(t,"Rectangle"),this.polygonType=s.polygonType.convex;let e=this.shape.attr("x"),i=this.shape.attr("y");this.width=this.shape.attr("width"),this.height=this.shape.attr("height"),this.baseVex=this.shape.attr("vex"),this.vex=this.baseVex.map(t=>[e+t[0],i+t[1]]),0!=this.rot&&(this.vex=n.rotateVex(this.vex,this.pos,this.rot)),this.area=this.calcArea(),0!==this.mass?this.density=this.calcDensity():this.mass=this.area*this.density,this.centroid=this.calcCentroid(),this.rotationInertia=this.calcRotationInertia(),this.static===a.staticType.position||this.static===a.staticType.total?this.inverseMass=0:this.inverseMass=1/this.mass,this.boundRect=this.createBoundRect()}calcArea(){return this.width*this.height}calcDensity(){return this.mass/this.area}calcCentroid(){return[this.pos[0],this.pos[1]]}calcRotationInertia(){return this.mass*r.Vector.dot([this.width,this.height],[this.width,this.height])/12}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(26),r=i(3),n=i(16);e.LayerManager=class{constructor(t){this.defaultZIndex=100,this.totalShapeCount=0,this.container=t,this.containerSize=[this.container.offsetWidth,this.container.offsetHeight],this.layerMap={},r.default.addListener("clone",this.clone.bind(this)),r.default.addListener("update",this.update.bind(this)),r.default.addListener("append",this.append.bind(this)),r.default.addListener("remove",this.remove.bind(this))}createLayer(t){this.layerMap[t]=new a.default(t,this.defaultZIndex,this.container,this.containerSize)}getHeight(){return this.containerSize[0]}getWidth(){return this.containerSize[1]}getTotalCount(){for(let t in this.layerMap)this.totalShapeCount+=this.layerMap[t].getCount();return this.totalShapeCount}getLayerMap(){return this.layerMap}append(t){let e=t.zIndex;void 0===this.layerMap[e]&&this.createLayer(e),this.layerMap[e].append(t.shape)}remove(t){let e=t.zIndex;this.layerMap[e].remove(t.shape),0===this.layerMap[e].getCount()&&this.destroyLayer(e)}destroyLayer(t){this.container.removeChild(this.layerMap[t].getCanvasElement()),delete this.layerMap[t]}update(t){this.layerMap[t].update()}clear(){for(let t in this.layerMap)this.layerMap[t].clear(),"0"!==t&&this.destroyLayer(parseInt(t))}clone(t){if("Group"===t.attr("type")){let e=new n.default.Group(t.config());return s.DFS(t.getShapeList(),t=>{e.append(this.clone(t))}),e}if("Composite"===t.attr("type")){let e=new n.default.Composite(t.config());return s.DFS(t.getShapeList(),t=>{e.join(this.clone(t))}),e}return new(n.default[t.attr("type")])(t.config())}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(27);e.default=class{constructor(t,e,i,a){this.zIndex=t,this.canvas=this.createCanvasElement(t,e,i,a),this.ctx=this.canvas.getContext("2d"),this.shapeHeap=new s.shapeHeap(this.ctx,a),this.count=0}createCanvasElement(t,e,i,s){let a=document.createElement("canvas");return a.style.position="absolute",a.style.top="0",a.style.left="0",a.width=s[0],a.height=s[1],a.style.zIndex=(t+e).toString(),i.appendChild(a),a}getCount(){return this.count}getCTX(){return this.ctx}append(t){this.shapeHeap.append(t),this.update(),this.count+=t.getCount()}remove(t){this.shapeHeap.remove(t),this.update(),this.count-=t.getCount()}update(){this.shapeHeap.update()}clear(){this.count=0,this.shapeHeap.clear()}getCanvasElement(){return this.canvas}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.ctx=t,this.containerSize=e,this.aSyncUpdateRequestCount=0,this.updateRequestCount=0}append(t){this.shapeHeapArray.push(t),t.toggleMount(!0)}remove(t){let e=t.attr("id");this.shapeHeapArray.map((t,i)=>{t.attr("id")===e&&this.shapeHeapArray.splice(i,1)}),t.toggleMount(!1)}clear(){this.shapeHeapArray.map(t=>{t.toggleMount(!1)}),this.shapeHeapArray=[],this.ctx.clearRect(0,0,this.containerSize[0],this.containerSize[1])}update(){this.updateRequestCount++,requestAnimationFrame(()=>{this.aSyncUpdateRequestCount++,this.aSyncUpdateRequestCount===this.updateRequestCount&&(this.updateRequestCount=this.aSyncUpdateRequestCount=0,this.reRender())})}reRender(){this.ctx.clearRect(0,0,this.containerSize[0],this.containerSize[1]);for(let t=0,e=this.shapeHeapArray.length;t<e;t++)this.ctx.save(),this.shapeHeapArray[t].render(this.ctx),this.ctx.restore()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(5);e.Custom=class extends s.Shape{constructor(t){super(t,"Custom"),this._draw=t.draw,this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{draw:this._draw})}drawPath(){return this.path=new Path2D,this._draw(a.drawTool.init(this.path,[this._x,this._y])),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(5),r=i(9);e.triangleConfig=class extends s.shapeConfig{};e.Triangle=class extends r.Polygon{constructor(t){super(t,"Triangle"),this._edge=t.edge,this.midEdge=this._edge/2,this.height=Math.sqrt(this._edge*this._edge-this.midEdge*this.midEdge),this._center=[this._x,this._y+this.height/2],this._vex=[[0,0],[-this.midEdge,this.height],[this.midEdge,this.height],[0,0]],this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:this._edge})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee([[-this.midEdge,this.height],[this.midEdge,this.height],[0,0]]).end(),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.circleConfig=class extends s.shapeConfig{};e.Circle=class extends s.Shape{constructor(t){super(t,"Circle"),this._center=[this._x,this._y],this._radius=t.radius,this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius})}drawPath(){return this.path=new Path2D,this.path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(5),r=i(9);e.rectangleConfig=class extends s.shapeConfig{};e.Rectangle=class extends r.Polygon{constructor(t){super(t,"Rectangle"),this._width=t.edge[0],this._height=t.edge[1],this._center=[this._x+this._width/2,this._y+this._height/2],this._vex=[[0,0],[this._width,0],[this._width,this._height],[0,this._height],[0,0]],this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height]})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee([[this._width,0],[this._width,this._height],[0,this._height],[0,0]]).end(),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Ellipse=class extends s.Shape{constructor(t){super(t,"Ellipse"),this._center=[this._x,this._y],this._radiusX=t.radius[0],this._radiusY=t.radius[1],this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:[this._radiusX,this._radiusY]})}drawPath(){return this.path=new Path2D,this.path.ellipse(this._x,this._y,this._radiusX,this._radiusY,0,0,2*Math.PI,!0),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(5);e.RoundRect=class extends s.Shape{constructor(t){super(t,"RoundRect"),this._width=t.edge[0],this._height=t.edge[1],this._round=t.round,this._center=[this._x+this._width/2,this._y+this._height/2+this._round],this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height],round:this._round})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y+this._round]).bee([[0,this._height-this._round]]).arc(this._round,180,90).bee([[this._width-this._round,this._height]]).arc(this._round,90,0).bee([[this._width,this._round]]).arc(this._round,0,-90).bee([[this._round,0]]).arc(this._round,-90,-180).end(),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Ring=class extends s.Shape{constructor(t){super(t,"Ring"),this._center=[this._x,this._y],this._radius=t.radius,this._width=t.width,this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius,width:this._width})}drawPath(){return this.path=new Path2D,this.path.arc(this._x,this._y,this._radius+this._width,0,2*Math.PI,!1),this.path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Sector=class extends s.Shape{constructor(t){super(t,"Sector"),this._center=[this._x,this._y],this._radius=t.radius,this._range=t.range,this.initSetter(),this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius,range:this._range})}drawPath(){return this.path=new Path2D,this.path.moveTo(this._x,this._y),this.path.arc(this._x,this._y,this._radius,this._range[0]/180*Math.PI,this._range[1]/180*Math.PI),this.path.closePath(),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.SVGPath=class extends s.Shape{constructor(t){super(t,"SVGPath"),this._svgPath=t.svgPath,this.createPath()}config(){return Object.assign({},this.getBaseConfig(),{svgPath:this._svgPath})}drawPath(){return this.path=new Path2D(this._svgPath),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),a=i(1),r=i(0);e.Group=class extends r.Base{constructor(t){super(t,"Group"),this.count=0,this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.append(t)}),this.initSetter()}config(){return{shapes:this.shapeList,mounted:this._mounted,removed:this._removed,tag:this._tag,show:this._show,zIndex:this._zIndex}}setShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}getShapeList(){return this.shapeList}isShapeAt(t){return this.shapeList.some(e=>e.attr("id")===t.attr("id"))}append(t){t instanceof Array?t.map(t=>this.append(t)):(t.attr("show",this._show),this.shapeList.push(t),this.count+=t.getCount(),this.isMount&&s.default.notify("update"))}remove(t){let e=t.attr("id");this.shapeList.map((t,i)=>{t.attr("id")===e&&this.shapeList.splice(i,1)}),this.count-=t.getCount(),this.isMount&&s.default.notify("update")}render(t){this._show&&a.DFS(this.shapeList,e=>{t.save(),e.render(t),t.restore()},!1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.TextBlock=class extends s.Shape{constructor(t){super(t,"Text"),this._maxWidth=t.maxWidth||null,this._fontSize=t.fontSize||10,this._content=t.content||"",this._align=t.align||"start",this._direction=t.dir||"inherit",this.font="px sans-serif",this._center=[],this.compositeCenter=[],this.compositeRotate=0,this.compositeScale=[1,1],this.tmpCtx=document.createElement("canvas").getContext("2d"),this.textWidth=this.tmpCtx.measureText(this._content).width,this.initSetter()}config(){return Object.assign({},this.getBaseConfig(),{content:this._content,fontSize:this._fontSize,align:this._align,dir:this._direction,maxWidth:this._maxWidth})}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e}setterRotate(t){this.lastRotate!==t&&(this._rotate=t,this.lastRotate=this._rotate)}setterScale(t){this.lastScale.toString()!==t.toString()&&(this._scale=t,this.lastScale=this._scale)}setterContent(t){this._content=t,this.tmpCtx.font=this._fontSize+this.font,this.textWidth=this.tmpCtx.measureText(this._content).width}setCompositeRotate(t,e){this.compositeCenter=t,this.compositeRotate=e}setCompositeScale(t,e){this.compositeCenter=t,this.compositeScale=e}textRotate(t,e,i){t.translate(e[0],e[1]),t.rotate(i/180*Math.PI),t.translate(-e[0],-e[1])}textScale(t,e,i){t.translate(e[0],e[1]),t.scale(i[0],i[1]),t.translate(-e[0],-e[1])}drawPath(){return this}rotatePath(){return this}scalePath(){return this}render(t){this._show&&(this.compositeCenter.length&&(this.textRotate(t,this.compositeCenter,this.compositeRotate),this.textScale(t,this.compositeCenter,this.compositeScale)),this.textRotate(t,[this._x+this.textWidth,this._y-this._fontSize/2],this._rotate),this.textScale(t,[this._x+this.textWidth,this._y-this._fontSize/2],this._scale),t.font=this._fontSize+this.font,t.direction=this._direction,t.textAlign=this._align,t.globalAlpha=this._opacity,this._fill?(t.fillStyle=this._color,this._maxWidth?t.fillText(this._content,this._x,this._y,this._maxWidth):t.fillText(this._content,this._x,this._y)):(t.strokeStyle=this._color,this._maxWidth?t.strokeText(this._content,this._x,this._y,this._maxWidth):t.strokeText(this._content,this._x,this._y)))}getTextWidth(){return this.textWidth}getTextHeight(){return this._fontSize+2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.lineConfig=class extends s.shapeConfig{};e.Line=class extends s.Shape{constructor(t){super(t,"Line"),this._range=t.range,this._fill=!1,this.initSetter(),this.createPath()}setterRange(t){this._range=t,this.drawPath()}config(){return Object.assign({},this.getBaseConfig(),{range:this._range})}drawPath(){return this.path=new Path2D,this.path.moveTo(this._range[0][0],this._range[0][1]),this.path.lineTo(this._range[1][0],this._range[1][1]),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(7),a=i(3);e.default=class{constructor(){this.animationHeap=[],this.isRun=!1,a.default.addListener("animation",this.add.bind(this))}add(t){this.animationHeap.push(t),this.isRun||(this.isRun=!0,this.loop())}loop(){let t=0;this.animationHeap.map(e=>{e.state!==s.state.final&&(e.animationFrame(),t++)}),this.animationHeap.length&&this.animationHeap[0].state===s.state.final&&this.animationHeap.shift(),t?window.requestAnimationFrame(this.loop.bind(this)):this.isRun=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(3);e.eventInfo=class{};e.keyBoardEvent=class{};e.event=class{};e.EventSystem=class{constructor(t,e,i){this.eventList=["click","mousemove","keypress","mouseover","mouseout"],this.container=t,this.layerMap=e,this.containerLeft=i[0],this.containerTop=i[1],this.clickEventList=[],this.mouseoverEventList=[],this.mouseoutEventList=[],this.mousemoveEventList=[],this.mousedownEventList=[],this.mouseupEventList=[],this.keypressEventMap={},a.default.addListener("add_event",this.addEvent.bind(this)),a.default.addListener("del_event",this.delEvent.bind(this)),this.init()}init(){this.bindKeyBoardEvent(),this.bindMouseEvent()}omitEvent(t,e,i,s){e({target:t,x:i,y:s})}bindMouseEvent(){this.container.addEventListener("click",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.clickEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mousedown",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mousedownEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mouseup",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mouseupEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mousemove",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mouseoverEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&(t.shape.isMouseIn()||(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!0)))}),this.mouseoutEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)||t.shape.isMouseIn()&&(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!1))}),this.mousemoveEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!0))})})}bindKeyBoardEvent(){document.addEventListener("keydown",t=>{this.keypressEventMap[t.keyCode]&&this.keypressEventMap[t.keyCode].map(t=>{this.omitEvent(t.shape,t.fn.fn)})})}addEvent(t){t.ctx=this.layerMap[t.zIndex].getCTX(),"keypress"===t.eventName?(void 0===this.keypressEventMap[t.fn.keyCode]&&(this.keypressEventMap[t.fn.keyCode]=[]),this.keypressEventMap[t.fn.keyCode].push(t)):this[t.eventName+"EventList"].push(t)}delEvent(t){let e=null;"keypress"===t.eventName?(e=this.keypressEventMap[t.keyCode]).map((i,s)=>{i.shape.attr("id")===t.shape.attr("id")&&e.splice(s,1)}):(e=this[t.eventName+"EventList"]).map((i,s)=>{i.shape.attr("id")===t.shape.attr("id")&&e.splice(s,1)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6);e.default=class{constructor(t,e){this.bodyList=t,this.collisionManager=e,this.isPause=!0}loopFrame(){this.collisionManager.collisionDetection.sweep().map(t=>this.collisionManager.collisionResolver.resolve(t));for(let t=0,e=this.bodyList.length;t<e;t++){let e=this.bodyList[t];e.state!==s.state.sleep&&e.update()}this.isPause?window.cancelAnimationFrame(this.raf):this.raf=window.requestAnimationFrame(this.loopFrame.bind(this))}start(){this.isPause=!1,this.loopFrame()}pause(){this.isPause=!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);var a;!function(t){t[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left"}(a=e.boundaryType||(e.boundaryType={}));class r{constructor(t){this.restitution=t.restitution||.8,this.friction=t.friction||.2,this.inverseMass=0,this.collidedFn=t.collided||(()=>{}),this.separatedFn=t.separated||(()=>{})}init(t){throw"此方法必须由子类重写"}collisionDetect(t){throw"此方法必须由子类重写"}findPointBehind(t){throw"此方法必须由子类重写"}collided(t){this.collidedFn.call(this,t)}separated(){this.separatedFn.call(this)}}e.Boundary=r;e.BoundaryTop=class extends r{constructor(t){super(t),this.type=a.top}init(t){this.range=[[0,0],[t[0],0]],this.nor=s.Vector.nol(s.Vector.nor(s.Vector.sub(this.range[1],this.range[0]))),this.nor[1]<0&&(this.nor=s.Vector.inv(this.nor))}collisionDetect(t){return-t.getBoundRect().ver[0]}findPointBehind(t){return t.filter(t=>t[1]<0)}};e.BoundaryRight=class extends r{constructor(t){super(t),this.type=a.right}init(t){this.range=[[t[0],0],[t[0],t[1]]],this.nor=s.Vector.nol(s.Vector.nor(s.Vector.sub(this.range[1],this.range[0]))),this.nor[0]>0&&(this.nor=s.Vector.inv(this.nor))}collisionDetect(t){return t.getBoundRect().hor[1]-this.range[0][0]}findPointBehind(t){return t.filter(t=>t[0]>this.range[0][0])}};e.BoundaryBottom=class extends r{constructor(t){super(t),this.type=a.bottom}init(t){this.range=[[0,t[1]],[t[0],t[1]]],this.nor=s.Vector.nol(s.Vector.nor(s.Vector.sub(this.range[1],this.range[0]))),this.nor[1]>0&&(this.nor=s.Vector.inv(this.nor))}collisionDetect(t){return t.getBoundRect().ver[1]-this.range[0][1]}findPointBehind(t){return t.filter(t=>t[1]>this.range[0][1])}};e.BoundaryLeft=class extends r{constructor(t){super(t),this.type=a.left}init(t){this.range=[[0,0],[0,t[1]]],this.nor=s.Vector.nol(s.Vector.nor(s.Vector.sub(this.range[1],this.range[0]))),this.nor[0]<0&&(this.nor=s.Vector.inv(this.nor))}collisionDetect(t){return-t.getBoundRect().hor[0]}findPointBehind(t){return t.filter(t=>t[0]<0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),a=i(1);e.default=class{constructor(t){this.boundaries=[],this.containerSize=t}add(t){this.boundaries[t.type]||(t.init(this.containerSize),this.boundaries[t.type]=t)}remove(t){delete this.boundaries[t.type]}clear(){for(let t in this.boundaries)delete this.boundaries[t]}concatDetection(t,e){return this.boundaries.map(i=>{let r=i.collisionDetect(t);if(i&&r>0){let n,o=t.getInfo();n=Array.isArray(o)?{len:r,nor:i.nor,edge:i.range,type:s.collisionType.p2b,p:a.findProjectionPoint(i.range,a.findMidPoint(i.findPointBehind(o)))}:{len:r,nor:i.nor,edge:i.range,type:s.collisionType.c2b,p:a.findProjectionPoint(i.range,[o.x,o.y])},e.push({body1:t,body2:null,collisionInfo:[n]}),t.linearVel[0]*=1-i.friction}}),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(46),a=i(48);e.default=class{constructor(t,e){this.collisionDetection=new s.default(t,e),this.collisionResolver=new a.default}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(47),a=i(10);e.collisionInfo=class{};e.collisionRes=class{};e.default=class{constructor(t,e){this.bodyList=t,this.boundariesManager=e}sweep(){let t=[];this.bodyList.sort((t,e)=>t.getBoundRect().hor[0]-e.getBoundRect().hor[0]);for(let e=0,i=this.bodyList.length;e<i;e++){t=this.boundariesManager.concatDetection(this.bodyList[e],t);for(let r=e+1;r<i;r++){let i=this.bodyList[e],n=this.bodyList[r],o=i.getBoundRect(),h=n.getBoundRect();if(!(o.hor[1]>=h.hor[0])){i.separated(),n.separated();break}if(s.AABBIntersect(o,h)){let e=a.default(i,n);e?t.push({body1:i,body2:n,collisionInfo:e}):(i.separated(),n.separated())}}}return t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.AABBIntersect=function(t,e){return s.isOverlaps(t.ver,e.ver)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),a=i(10);e.default=class{constructor(){this.collisionNormal=[0,0]}calcCollisionNormal(t,e,i){if(null===e)return i.nor;let r=t.pos,n=e.pos,o=i.edge,h=[],c=0;if(i.type===a.collisionType.c2c)return s.Vector.nol(s.Vector.sub(r,n));if(o){let t=s.Vector.nol(i.nor),e=[];return o[0][1]!==o[1][1]?(o[0][1]>o[1][1]?(e=s.Vector.sub(o[0],o[1]),h=s.Vector.sub(n,o[1])):(e=s.Vector.sub(o[1],o[0]),h=s.Vector.sub(n,o[0])),((c=s.Vector.cor(e,h))<0&&t[0]>0||c>0&&t[0]<0)&&(t=s.Vector.inv(t))):(o[0][0]>o[1][0]?(e=s.Vector.sub(o[0],o[1]),h=s.Vector.sub(n,o[1])):(e=s.Vector.sub(o[1],o[0]),h=s.Vector.sub(n,o[0])),((c=s.Vector.cor(e,h))<0&&t[1]<0||c>0&&t[1]>0)&&(t=s.Vector.inv(t))),t}return s.Vector.nol(s.Vector.sub(r,n))}resolveRebound(t,e,i){let a=t.linearVel,r=t.restitution,n=i.p,o=0,h=0,c=0,l=t.inverseMass,u=[0,0];e&&(a=s.Vector.sub(a,e.linearVel),r=.5*(r+e.restitution),l+=e.inverseMass),(o=s.Vector.dot(a,this.collisionNormal))>0||(c=(h=-o*r)-o,u=s.Vector.scl(c/l,this.collisionNormal),n?(t.linearVel=s.Vector.add(t.linearVel,s.Vector.scl(t.inverseMass,u)),t.angularVel+=1/t.rotationInertia*s.Vector.cor(s.Vector.sub(n,t.centroid),u)*10,e&&(e.linearVel=s.Vector.add(e.linearVel,s.Vector.scl(-e.inverseMass,u)),e.angularVel+=1/e.rotationInertia*s.Vector.cor(s.Vector.sub(n,e.centroid),s.Vector.inv(u))*10)):(t.linearVel=s.Vector.add(t.linearVel,s.Vector.scl(t.inverseMass,u)),e&&(e.linearVel=s.Vector.add(e.linearVel,s.Vector.scl(-e.inverseMass,u)))))}resolvePenetration(t,e,i){let a,r,n,o=t.inverseMass,h=i.len;e&&(o+=e.inverseMass),a=s.Vector.scl(h/o,this.collisionNormal),r=s.Vector.add(t.pos,s.Vector.scl(t.inverseMass,a)),t.setPos(r),e&&(n=s.Vector.add(e.pos,s.Vector.scl(-e.inverseMass,a)),e.setPos(n))}resolve(t){let e=t.body1,i=t.body2;for(let s=0,a=t.collisionInfo.length;s<a;s++){let a=t.collisionInfo[s];this.collisionNormal=this.calcCollisionNormal(e,i,a),this.resolvePenetration(e,i,a),this.resolveRebound(e,i,a)}this.collisionNormal=[0,0],e.collided(i),i&&i.collided(e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4),a=i(6),r=i(2),n=i(1);e.TriBody=class extends s.PolygonBody{constructor(t){super(t,"Triangle"),this.baseVex=this.shape.attr("vex"),this.polygonType=s.polygonType.convex,this.edge=this.shape.attr("edge");let e=this.shape.attr("x"),i=this.shape.attr("y"),r=this.edge/2;this.height=Math.sqrt(this.edge*this.edge-r*r),this.baseVex=this.shape.attr("vex"),this.vex=this.baseVex.map(t=>[e+t[0],i+t[1]]),0!=this.rot&&(this.vex=n.rotateVex(this.vex,this.pos,this.rot)),this.area=this.calcArea(),this.mass=this.mass||this.area*this.density,this.centroid=this.calcCentroid(),this.rotationInertia=this.calcRotationInertia(),this.static===a.staticType.position||this.static===a.staticType.total?this.inverseMass=0:this.inverseMass=1/this.mass,this.boundRect=this.createBoundRect()}initBodyData(){}calcArea(){return.5*this.edge*this.height}calcDensity(){return this.mass/this.area}calcCentroid(){return this.pos}calcRotationInertia(){let t=r.Vector.sub(this.vex[1],this.vex[0]),e=r.Vector.sub(this.vex[2],this.vex[0]);return this.mass/6*(r.Vector.dot(t,t)+r.Vector.dot(t,e)+r.Vector.dot(e,e))}}}]);