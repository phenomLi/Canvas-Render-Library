!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(11),n=i(3);class h{constructor(t,e){this._id=Symbol(),this._type=e,this._show=!t||void 0===t.show||t.show,this._tag=t&&t.tag?t.tag:"",this._zIndex=t&&t.zIndex?t.zIndex:0,this._mounted=t&&t.mounted?t.mounted:()=>{},this._removed=t&&t.removed?t.removed:()=>{},this.isMount=!1,this.count=1}initSetter(){a.default[this._type].writableProperties.map(t=>{let e=t.substring(0,1).toUpperCase()+t.substring(1);void 0===this["setter"+e]&&(this["setter"+e]=function(e){this["_"+t]=e,a.default[this._type].notRePathProperties.includes(t)||this.createPath(!0)})})}setLayerManagerContext(t){this.layerManager=t,"Composite"!==this._type&&"Group"!==this._type||this.getShapeList().map(e=>{e.setLayerManagerContext(t)})}setLayerContext(t){this.layer=t,"Composite"!==this._type&&"Group"!==this._type||this.getShapeList().map(e=>{e.setLayerContext(t)})}setEventSystemContext(t){this.eventSystem=t,"Composite"!==this._type&&"Group"!==this._type||this.getShapeList().map(e=>{e.setEventSystemContext(t)})}setAnimationManagerContext(t){this.animationManager=t,"Composite"!==this._type&&"Group"!==this._type||this.getShapeList().map(e=>{e.setAnimationManagerContext(t)})}attr(t,e){return void 0!==e?(this["setter"+(t.substring(0,1).toUpperCase()+t.substring(1))](e),this.isMount&&this.layer.update(),this):this["_"+t]}toggleMount(t){this.isMount=t,t?this.mounted():this.removed(),"Group"!==this._type&&"Composite"!==this._type||this.getShapeList().map(e=>{e.toggleMount(t)})}getCount(){return this.count}getShapeList(){throw"此方法必须由子类重写"}config(){throw"此方法必须由子类重写"}mounted(){this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}}e.Base=h;e.shapeConfig=class{};e.Shape=class extends h{constructor(t,e){super(t,e),a.default[e].requiredProperties.map(i=>{if(void 0===t[i])throw`${i}为${e}的必填属性`}),this._x=t.pin?t.pin[0]:0,this._y=t.pin?t.pin[1]:0,this._color=t.color||"#000",this._fill=void 0===t.fill||t.fill,this._lineWidth=t.lineWidth||1,this._opacity=t.opacity||1,this._shadow=t.shadow?t.shadow.split(" "):["0","0","0","#000"],this._rotate=t.rotate||0,this._scale=t.scale||[1,1],this._rotate>=360&&(this._rotate%=360),this.lastX=this._x,this.lastY=this._y,this.lastRotate=0,this.lastScale=[1,1],this.mouseIn=!1,this.isAnimating=!1,this.eventList=[],this.camelCaseEventName={},this.rePathRequestCount=0,this.aSyncRePathRequestCount=0;for(let e in t)/^on./g.test(e)&&(this.camelCaseEventName[e]=t[e],this.bind(e.toLowerCase().substring(2),t[e]))}getBaseConfig(){return Object.assign(Object.assign({pin:[this._x,this._y],center:this._center,color:this._color,fill:this._fill,opacity:this._opacity,shadow:this._shadow,rotate:this._rotate,scale:this._scale,zIndex:this._zIndex,tag:this._tag},this.camelCaseEventName),{mounted:this._mounted,removed:this._removed})}isMouseIn(t){if(void 0===t)return this.mouseIn;this.mouseIn=t}getPath(){return this.path}setPath(t){this.path=t}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.transformPath()}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.transformPath()}setterRotate(t){t>=360&&(t%=360),this._rotate=t,this.transformPath()}setterScale(t){this._scale=t,this.transformPath()}setterZIndex(t){t!==this._zIndex&&(this.layer.remove(this),this.layerManager.append({shape:this,zIndex:t}),this._zIndex=t)}addEvent(t){t.map(t=>{t.fn instanceof Array?t.fn.map(e=>{this.eventSystem.addEvent({shape:this,eventName:t.eventName,fn:e,zIndex:this._zIndex})}):this.eventSystem.addEvent({shape:this,eventName:t.eventName,fn:t.fn,zIndex:this._zIndex})})}delEvent(t){t.map(t=>{"keypress"===t.eventName?this.eventSystem.delEvent({shape:this,eventName:t.eventName,keyCode:t.keyCode}):this.eventSystem.delEvent({shape:this,eventName:t.eventName})})}bind(t,e){"keypress"===t?e instanceof Array?e.map(t=>t.fn=t.fn.bind(this)):e.fn=e.fn.bind(this):e=e.bind(this),this.isMount&&this.addEvent([{eventName:t,fn:e}]),this.eventList.push({eventName:t,fn:e})}unbind(t,e){"keypress"===t?this.delEvent([{eventName:t,keyCode:e}]):this.delEvent([{eventName:t}])}getEventList(){return this.eventList}animateTo(t,e){let i=[],s=this;for(let e in t.target)a.default[s._type].animateProperties.includes(e)?i.push([s["_"+e],t.target[e]]):delete t.target[e];let h=new n.default(this,{value:i,duration:t.duration,delay:t.delay,timingFunction:t.timingFunction,render:function(){let e=0;for(let i in t.target)s.attr(i,arguments[e++])}}).final(e);t.loop?h.loop():h.start()}mounted(){this.addEvent(this.eventList),this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this.delEvent(this.eventList),this._removed&&"function"==typeof this._removed&&this._removed()}createPath(t=!1){this.drawPath().transformPath(t)}transformPath(t=!1){this.translatePath().rotatePath()}drawPath(){return this}translatePath(){if(this.lastX===this._x&&this.lastY===this._y)return this;let t=new Path2D;return t.addPath(this.path,s.translate([this._x-this.lastX,this._y-this.lastY])),this.path=t,this.lastX=this._x,this.lastY=this._y,this}rotatePath(){if(this._rotate===this.lastRotate)return this;let t=new Path2D;return t.addPath(this.path,s.rotate(this._center,this._rotate-this.lastRotate)),this.path=t,this.lastRotate=this._rotate,this}scalePath(){if(this._scale.toString()===this.lastScale.toString())return this;let t=new Path2D,e=[this._scale[0]/this.lastScale[0],this._scale[1]/this.lastScale[1]];return t.addPath(this.path,s.scale(this._center,e)),this.path=t,this.lastScale=this._scale,this}render(t){this._show&&(t.globalAlpha=this._opacity,t.shadowBlur=parseInt(this._shadow[0]),t.shadowOffsetX=parseInt(this._shadow[1]),t.shadowOffsetY=parseInt(this._shadow[2]),t.shadowColor=this._shadow[3],this._fill?(t.fillStyle=this._color,t.fill(this.path)):(t.lineWidth=this._lineWidth,t.strokeStyle=this._color,t.stroke(this.path)))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),a=i(4);function n(t,e,i=!0){t.map(t=>{"Group"===t.attr("type")||"Composite"===t.attr("type")?(i&&e(t),n(t.getShapeList(),e)):e(t)})}e.DFS=n,e.closePolyVex=function(t){t[t.length-1]&&t[0].toString()!==t[t.length-1].toString()&&t.push(t[0])},e.calcPolyRange=function(t,e,i){let s=t[0][0],a=t[0][1],n=t[0][0],h=t[0][1];return t.map(t=>{t[0]<n&&(n=t[0]),t[0]>s&&(s=t[0]),t[1]<h&&(h=t[1]),t[1]>a&&(a=t[1])}),[[e+n,e+s],[i+h,i+a]]},e.translate=function(t){return a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.TranslateMatrix},e.rotate=function(t,e){let i=e/180*Math.PI;return a.Matrix.init(a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.Matrix.set(a.RotateMatrix,[[Math.cos(i),-1*Math.sin(i),0],[Math.sin(i),Math.cos(i),0]]),a.Matrix.mul(a.TranslateMatrix,a.RotateMatrix,a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,-t[0]],[0,1,-t[1]]]),a.Matrix.mul(a.ResultMatrix,a.TranslateMatrix,a.ResultMatrix),a.ResultMatrix},e.scale=function(t,e){return a.Matrix.init(a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,t[0]],[0,1,t[1]]]),a.Matrix.set(a.ScaleMatrix,[[e[0],0,0],[0,e[1],0]]),a.Matrix.mul(a.TranslateMatrix,a.ScaleMatrix,a.ResultMatrix),a.Matrix.set(a.TranslateMatrix,[[1,0,-t[0]],[0,1,-t[1]]]),a.Matrix.mul(a.ResultMatrix,a.TranslateMatrix,a.ResultMatrix),a.ResultMatrix},e.arrayDeepCopy=function t(e){return e.map(e=>Array.isArray(e)?t(e):e)},e.isInShape=function(t,e,i,a){if(e instanceof s.Composite){let s=!1;return n(e.getShapeList(),e=>{t.isPointInPath(e.getPath(),i,a)&&(s=!0)},!1),s}return t.isPointInPath(e.getPath(),i,a)},e.isInPath=function(t,e,i,a){if(e instanceof s.Composite){let s=!1;return n(e.getShapeList(),e=>{t.isPointInStroke(e.getPath(),i,a)&&(s=!0)},!1),s}return t.isPointInStroke(e.getPath(),i,a)},e.getRandomColor=function(){return"rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(10*Math.random())+")"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);e.drawTool=new class{constructor(){}init(t,e){return this.path=t,this.oX=e[0],this.oY=e[1],this.endX=this.oX,this.endY=this.oY,this.tPath=new Path2D,s.Matrix.set(s.TranslateMatrix,[[1,0,this.oX],[0,1,this.oY]]),this.tPath.moveTo(0,0),this}bee(t){for(let e=0;e<t.length;e++)this.tPath.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,i){this.tPath.moveTo(this.endX,this.endY),this.tPath.bezierCurveTo(t[0],t[1],e[0],e[1],i[0],i[1]),this.endX=i[0],this.endY=i[1]}arc(t,e,i,s=!0){let a,n;return a=this.endX-t*Math.cos((360-e)/180*Math.PI),n=this.endY+t*Math.sin((360-e)/180*Math.PI),this.tPath.arc(a,n,t,e/180*Math.PI,i/180*Math.PI,s),this.endX=a-t*Math.cos((360-i)/180*Math.PI),this.endY=n+t*Math.sin((360-i)/180*Math.PI),this}move(t,e){this.tPath.moveTo(t,e),this.endX=t,this.endY=e}end(t=!0){t&&this.tPath.closePath(),this.path.addPath(this.tPath,s.TranslateMatrix),s.Matrix.init(s.TranslateMatrix)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(12);var a;!function(t){t[t.init=0]="init",t[t.play=1]="play",t[t.stop=2]="stop",t[t.end=3]="end",t[t.final=4]="final"}(a=e.state||(e.state={}));e.default=class{constructor(t,e){this.id=Symbol(),this.shape=t,this.isAdd=!1,this.isLoop=!1,this.animationQueue=[],this.animationQueueIndex=0,this.animationQueue.push(e),this.init(e)}init(t){return this._value=[],this._duration=t.duration||1e3,this._delay=t.delay||0,this._timingFunction=t.timingFunction?s.default[t.timingFunction]:s.default.linear,this._renderFunction=t.render||((...t)=>{}),this._onStart=t.onStart||(()=>{}),this._onEnd=t.onEnd||(()=>{}),this._onStop=t.onStop||(()=>{}),this.state=a.init,this.initValue(t.value),this}initValue(t){t.every(t=>t instanceof Array)?t.map(t=>{this._value.push({start:t[0],end:t[1]})}):this._value.push({start:t[0],end:t[1]})}animationFrame(){let t=Date.now()-this.beginTime;t>=this._duration||this.state===a.end?(this.renderFunction(this._duration,this._duration),this.end()):this.state===a.stop?this.renderFunction(t,this._duration):this.state===a.init?this.renderFunction(0,this._duration):this.renderFunction(t,this._duration)}renderFunction(t,e){const i=this._value.map(i=>this._timingFunction(t,i.start,i.end-i.start,e));this._renderFunction.apply(this.shape,i)}finalFunction(){this.isLoop?(this.state=a.init,this.animationQueueIndex=0,this.init(this.animationQueue[this.animationQueueIndex]).start()):this._onFinal&&this._onFinal()}setAnimationContext(t){this.animationManager=t}start(){this.animationQueueIndex++,setTimeout(()=>{this.state=a.play,this.beginTime=Date.now(),this._onStart(),this.isAdd||(this.shape.animationManager.add(this),this.isAdd=!0)},this._delay)}loop(){this.isLoop=!0,this.start()}stop(){this.state===a.play&&(this.state=a.stop,this._onStop())}end(){this.state===a.play&&(this.state=a.end,this._onEnd(),this.animationQueueIndex<this.animationQueue.length?this.init(this.animationQueue[this.animationQueueIndex]).start():(this.state=a.final,this.finalFunction()))}final(t){return this._onFinal=t,this}next(t){return this.animationQueue.push(t),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){t&&t.length?(this.a=t[0][0],this.b=t[1][0],this.c=t[0][1],this.d=t[1][1],this.e=t[0][2],this.f=t[1][2]):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}}e.Matrix={init(t){t.a=1,t.b=0,t.c=0,t.d=1,t.e=0,t.f=0},set(t,e){t.a=e[0][0],t.b=e[1][0],t.c=e[0][1],t.d=e[1][1],t.e=e[0][2],t.f=e[1][2]},mul(t,e,i){i.a=t.a*e.a+t.c*e.b,i.b=t.b*e.a+t.d*e.b,i.c=t.a*e.c+t.c*e.d,i.d=t.b*e.c+t.d*e.d,i.e=t.a*e.e+t.c*e.f+t.e,i.f=t.b*e.e+t.d*e.f+t.f},add(t,e,i){i.a=t.a+e.a,i.b=t.b+e.b,i.c=t.c+e.c,i.d=t.d+e.d,i.e=t.e+e.e,i.f=t.f+e.f},create:t=>new s(t),createSVGMatrix(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t&&t.length&&(e.a=t[0][0],e.b=t[1][0],e.c=t[0][1],e.d=t[1][1],e.e=t[0][2],e.f=t[1][2]),e}},e.RotateMatrix=e.Matrix.createSVGMatrix(),e.ScaleMatrix=e.Matrix.createSVGMatrix(),e.TranslateMatrix=e.Matrix.createSVGMatrix(),e.ResultMatrix=e.Matrix.createSVGMatrix()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(2),n=i(1);class h extends s.shapeConfig{}e.polygonConfig=h;class r extends s.Shape{constructor(t,e){if(super(t,e||"Polygon"),"Polygon"!==this._type)return;if(this._vex=t.vex,this._vex.length<3)throw"多边形定点数必须大于3.";let i=n.calcPolyRange(this._vex,this._x,this._y);this._center=[i[0][0]+(i[0][1]-i[0][0])/2,i[1][0]+(i[1][1]-i[1][0])/2],this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{vex:this._vex})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee(this._vex).end(),this}}e.Polygon=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(1);s.shapeConfig;class n extends s.Shape{constructor(t){super(t,"Composite"),this._center=t.center,this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.join(t,this.deep)}),this.initSetter()}join(t,e){if(t instanceof Array)t.map(t=>this.join(t,e));else{if("Group"===t.attr("type"))return void console.warn("group类型不能加入composite");this.shapeList.push(this.shapeProcessor(t,{x:this._x,y:this._y})),this.isMount&&this.layer.update()}}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{deep:this.deep,shapes:this.shapeList})}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.shapeList.map(t=>{this.shapeProcessor(t,{x:e,y:0})})}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.shapeList.map(t=>{this.shapeProcessor(t,{x:0,y:e})})}setterShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}setterRotate(t){t>=360&&(t%=360),this._rotate=t,a.DFS(this.getShapeList(),t=>{t.transformPath()},!1),this.shapeList.map(t=>{this.rotatePath(t)})}setterScale(t){return a.DFS(this.getShapeList(),t=>{t.transformPath()},!1),this.shapeList.map(t=>{this.scalePath(t)}),this}getShapeList(){return this.shapeList}shapeProcessor(t,e){return t.attr("x",t.attr("x")+e.x).attr("y",t.attr("y")+e.y),this._rotate&&this.rotatePath(t),this._scale&&this.scalePath(t),t}rotatePath(t){if("Composite"===t.attr("type"))a.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),a.rotate(this._center,this._rotate)),t.setPath(e)},!1);else if("Text"===t.attr("type"))t.setCompositeRotate(this._center,this._rotate);else{let e=new Path2D;e.addPath(t.getPath(),a.rotate(this._center,this._rotate)),t.setPath(e)}return this}scalePath(t){if("Composite"===t.attr("type"))a.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),a.scale(this._center,this._scale)),t.setPath(e)},!1);else if("Text"===t.attr("type"))t.setCompositeScale(this._center,this._scale);else{let e=new Path2D;e.addPath(t.getPath(),a.scale(this._center,this._scale)),t.setPath(e)}return this}render(t){this._show&&a.DFS(this.shapeList,e=>{t.save(),e.render(t),t.restore()},!1)}}e.Composite=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(15),a=i(16),n=i(17),h=i(18),r=i(19),o=i(20),d=i(21),c=i(22),u=i(5),p=i(23),l=i(24),_=i(6),g=i(25),f=i(26);e.default={Custom:s.Custom,Circle:n.Circle,Rectangle:h.Rectangle,Triangle:a.Triangle,Group:l.Group,Composite:_.Composite,Ellipse:r.Ellipse,RoundRect:o.RoundRect,Sector:c.Sector,Ring:d.Ring,Polygon:u.Polygon,SVGPath:p.SVGPath,Line:f.Line,Text:g.TextBlock}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9);e.R=s.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),a=i(1),n=i(27),h=i(28),r=i(7),o=i(4),d=i(29),c=i(3),u={isInShape:a.isInShape,isInPath:a.isInPath,arrayDeepCopy:a.arrayDeepCopy,getRandomColor:a.getRandomColor},p={Matrix:o.Matrix,Vector:d.Vector};e.default=class{constructor(t,e){this.container=t,e&&e.size?(this.container.style.width=e.size[0]+"px",this.container.style.height=e.size[1]+"px",this.containerWidth=e.size[0],this.containerHeight=e.size[1]):(this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.offsetHeight),e&&e.offset?(this.containerLeft=e.offset[0],this.containerTop=e.offset[1]):(this.containerLeft=t.scrollLeft+t.offsetLeft,this.containerTop=t.scrollTop+t.offsetTop),this.container.style.position="relative",this.container.style.userSelect="none",this.layerManager=new s.LayerManager(this.container,[this.containerWidth,this.containerHeight]),this.eventSystem=new h.EventSystem(this.container,this.layerManager.getLayerMap(),[this.containerLeft,this.containerTop]),this.animationManager=new n.default,this.shapes=r.default,this.utils=u,this.math=p,this.animation=c.default}getHeight(){return this.containerHeight}getWidth(){return this.containerWidth}getShapesCount(){return this.layerManager.getTotalCount()}bind(t,e){"keypress"===t?this.container.addEventListener("keydown",(function(i){i.keyCode===t.keyCode&&e()})):this.container.addEventListener(t,function(t){let i=t.clientX-this.containerLeft,s=t.clientY-this.containerTop;e({x:i,y:s})}.bind(this))}append(t){void 0!==t&&(t instanceof Array?t.map(t=>this.append(t)):(t.setEventSystemContext(this.eventSystem),t.setAnimationManagerContext(this.animationManager),this.layerManager.append({shape:t,zIndex:t.attr("zIndex")})))}remove(t){void 0!==t&&this.layerManager.remove({shape:t,zIndex:t.attr("zIndex")})}clear(){this.layerManager.clear()}clone(t){return this.layerManager.clone(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(13),n=i(7);e.appendInfo=class{};e.LayerManager=class{constructor(t,e){this.defaultZIndex=100,this.totalShapeCount=0,this.container=t,this.containerSize=e,this.layerMap={}}createLayer(t){this.layerMap[t]=new a.default(t,this.defaultZIndex,this.container,this.containerSize)}getHeight(){return this.containerSize[0]}getWidth(){return this.containerSize[1]}getTotalCount(){for(let t in this.layerMap)this.totalShapeCount+=this.layerMap[t].getCount();return this.totalShapeCount}getLayerMap(){return this.layerMap}append(t){let e=t.zIndex;void 0===this.layerMap[e]&&this.createLayer(e),t.shape.setLayerManagerContext(this),this.layerMap[e].append(t.shape)}remove(t){let e=t.zIndex;this.layerMap[e].remove(t.shape),0===this.layerMap[e].getCount()&&this.destroyLayer(e)}destroyLayer(t){this.container.removeChild(this.layerMap[t].getCanvasElement()),delete this.layerMap[t]}update(t){this.layerMap[t].update()}clear(){for(let t in this.layerMap)this.layerMap[t].clear(),"0"!==t&&this.destroyLayer(parseInt(t))}clone(t){if("Group"===t.attr("type")){let e=new n.default.Group(t.config());return s.DFS(t.getShapeList(),t=>{e.append(this.clone(t))}),e}if("Composite"===t.attr("type")){let e=new n.default.Composite(t.config());return s.DFS(t.getShapeList(),t=>{e.join(this.clone(t))}),e}return new(n.default[t.attr("type")])(t.config())}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={baseProp:{writableProperties:[],readonlyProperties:[],animateProperties:[],notRePathProperties:[],readableProperties:[],requiredProperties:[]},init(){return this.baseProp.writableProperties=["x","y","color","fill","opacity","rotate","scale","show","zIndex","lineWidth","tag","shadow"],this.baseProp.readonlyProperties=["id","type","center"],this.baseProp.animateProperties=["x","y","color","opacity","rotate","lineWidth"],this.baseProp.notRePathProperties=["color","fill","opacity","show","lineWidth","shadow"],this.baseProp.requiredProperties=["pin"],this.baseProp.readableProperties=[],this},handle(t,e,i){switch(t){case"add":this.add(e,i);break;case"remove":this.remove(e,i);break;case"replace":this.baseProp[e]=i}},writableProperties(t,e){return this.handle(t,"writableProperties",e),this},readonlyProperties(t,e){return this.handle(t,"readonlyProperties",e),this},animateProperties(t,e){return this.handle(t,"animateProperties",e),this},notRePathProperties(t,e){return this.handle(t,"notRePathProperties",e),this},requiredProperties(t,e){return this.handle(t,"requiredProperties",e),this},add(t,e){return Array.isArray(e)?e.map(e=>this.baseProp[t].push(e)):this.baseProp[t].push(e),this},remove(t,e){return Array.isArray(e)?e.map(e=>{this.baseProp[t].splice(this.baseProp[t].findIndex(t=>t===e),1)}):this.baseProp[t].splice(this.baseProp[t].findIndex(t=>t===e),1),this},merge:(t,e)=>t.concat(e),get(){return Object.assign(Object.assign({},this.baseProp),{readableProperties:this.merge(this.baseProp.readonlyProperties,this.baseProp.writableProperties)})}};e.default={Line:(s.init(),s.writableProperties("add",["range","curveness","percent"]),s.animateProperties("replace",["curveness","percent"]),s.requiredProperties("replace",["range"]),s.get()),Circle:(s.init(),s.writableProperties("add","radius"),s.animateProperties("add","radius"),s.requiredProperties("add","radius"),s.get()),Ring:(s.init(),s.writableProperties("add",["radius","width"]),s.animateProperties("add",["radius","width"]),s.requiredProperties("add",["radius","width"]),s.get()),Sector:(s.init(),s.writableProperties("add",["radius","range"]),s.animateProperties("add",["radius","range"]),s.requiredProperties("add",["radius","range"]),s.get()),Ellipse:(s.init(),s.writableProperties("add",["radiusX","radiusY"]),s.animateProperties("add",["radiusX","radiusY"]),s.requiredProperties("add","radius"),s.get()),Rectangle:(s.init(),s.writableProperties("add",["width","height"]),s.animateProperties("add",["width","height"]),s.requiredProperties("add","edge"),s.readonlyProperties("add","vex"),s.get()),RoundRect:(s.init(),s.writableProperties("add",["round","height","width"]),s.animateProperties("add",["round","height","width"]),s.requiredProperties("add",["round","edge"]),s.get()),Triangle:(s.init(),s.writableProperties("add","edge"),s.animateProperties("add","edge"),s.requiredProperties("add","edge"),s.readonlyProperties("add","vex"),s.get()),Polygon:(s.init(),s.writableProperties("add","vex"),s.requiredProperties("add","vex"),s.get()),Custom:(s.init(),s.get()),SVGPath:(s.init(),s.writableProperties("add","svgPath"),s.requiredProperties("add",["svgPath","center"]),s.get()),Text:(s.init(),s.writableProperties("add",["align","dir","content","fontSize"]),s.animateProperties("add","fontSize"),s.notRePathProperties("replace",s.merge(s.baseProp.writableProperties,s.baseProp.readonlyProperties)),s.get()),Composite:(s.init(),s.writableProperties("remove",["color","fill","opacity"]),s.animateProperties("remove",["color","opacity"]),s.notRePathProperties("remove",["color","fill","opacity"]),s.requiredProperties("add","center"),s.get()),Group:(s.init(),s.readonlyProperties("remove","center"),s.writableProperties("replace",["show"]),s.animateProperties("replace",[]),s.notRePathProperties("replace",["show"]),s.get())}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={linear:(t,e,i,s)=>i*t/s+e,easeIn:(t,e,i,s)=>i*(t/=s)*t+e,easeOut:(t,e,i,s)=>-i*(t/=s)*(t-2)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,easeInCubic:(t,e,i,s)=>i*(t/=s)*t*t+e,easeOutCubic:(t,e,i,s)=>i*((t=t/s-1)*t*t+1)+e,easeInOutCubic:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e,easeInQuart:(t,e,i,s)=>i*(t/=s)*t*t*t+e,easeOutQuart:(t,e,i,s)=>-i*((t=t/s-1)*t*t*t-1)+e,easeInOutQuart:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e,easeInQuint:(t,e,i,s)=>i*(t/=s)*t*t*t*t+e,easeOutQuint:(t,e,i,s)=>i*((t=t/s-1)*t*t*t*t+1)+e,easeInOutQuint:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,easeInSine:(t,e,i,s)=>-i*Math.cos(t/s*(Math.PI/2))+i+e,easeOutSine:(t,e,i,s)=>i*Math.sin(t/s*(Math.PI/2))+e,easeInOutSine:(t,e,i,s)=>-i/2*(Math.cos(Math.PI*t/s)-1)+e,easeInExpo:(t,e,i,s)=>0==t?e:i*Math.pow(2,10*(t/s-1))+e,easeOutExpo:(t,e,i,s)=>t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e,easeInOutExpo:(t,e,i,s)=>0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e,easeInCirc:(t,e,i,s)=>-i*(Math.sqrt(1-(t/=s)*t)-1)+e,easeOutCirc:(t,e,i,s)=>i*Math.sqrt(1-(t=t/s-1)*t)+e,easeInOutCirc:(t,e,i,s)=>(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInElastic(t,e,i,s,a,n){let h;return 0==t?e:1==(t/=s)?e+i:(void 0===n&&(n=.3*s),!a||a<Math.abs(i)?(h=n/4,a=i):h=n/(2*Math.PI)*Math.asin(i/a),-a*Math.pow(2,10*(t-=1))*Math.sin((t*s-h)*(2*Math.PI)/n)+e)},easeOutElastic(t,e,i,s,a,n){let h;return 0==t?e:1==(t/=s)?e+i:(void 0===n&&(n=.3*s),!a||a<Math.abs(i)?(a=i,h=n/4):h=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin((t*s-h)*(2*Math.PI)/n)+i+e)},easeInOutElastic(t,e,i,s,a,n){let h;return 0==t?e:2==(t/=s/2)?e+i:(void 0===n&&(n=s*(.3*1.5)),!a||a<Math.abs(i)?(a=i,h=n/4):h=n/(2*Math.PI)*Math.asin(i/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*s-h)*(2*Math.PI)/n)*-.5+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*s-h)*(2*Math.PI)/n)*.5+i+e)},easeInBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),i*(t/=s)*t*((a+1)*t-a)+e),easeOutBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),i*((t=t/s-1)*t*((a+1)*t+a)+1)+e),easeInOutBack:(t,e,i,s,a)=>(void 0===a&&(a=1.70158),(t/=s/2)<1?i/2*(t*t*((1+(a*=1.525))*t-a))+e:i/2*((t-=2)*t*((1+(a*=1.525))*t+a)+2)+e),easeInBounce:(t,e,i,a)=>i-s.easeOutBounce(a-t,0,i,a)+e,easeOutBounce:(t,e,i,s)=>(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,easeInOutBounce:(t,e,i,a)=>t<a/2?.5*s.easeInBounce(2*t,0,i,a)+e:.5*s.easeOutBounce(2*t-a,0,i,a)+.5*i+e};e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(14);e.default=class{constructor(t,e,i,a){this.zIndex=t,this.canvas=this.createCanvasElement(t,e,i,a),this.ctx=this.canvas.getContext("2d"),this.shapeHeap=new s.shapeHeap(this.ctx,a),this.count=0}createCanvasElement(t,e,i,s){let a=document.createElement("canvas");return a.style.position="absolute",a.style.top="0",a.style.left="0",a.width=s[0],a.height=s[1],a.style.zIndex=(t+e).toString(),i.appendChild(a),a}getCount(){return this.count}getCTX(){return this.ctx}append(t){t.setLayerContext(this),this.shapeHeap.append(t),this.update(),this.count+=t.getCount()}remove(t){this.shapeHeap.remove(t),this.update(),this.count-=t.getCount()}update(){this.shapeHeap.update()}clear(){this.count=0,this.shapeHeap.clear()}getCanvasElement(){return this.canvas}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.ctx=t,this.containerSize=e,this.aSyncUpdateRequestCount=0,this.updateRequestCount=0}append(t){this.shapeHeapArray.push(t),t.toggleMount(!0)}remove(t){let e=t.attr("id");this.shapeHeapArray.map((t,i)=>{t.attr("id")===e&&this.shapeHeapArray.splice(i,1)}),t.toggleMount(!1)}clear(){this.shapeHeapArray.map(t=>{t.toggleMount(!1)}),this.shapeHeapArray=[],this.ctx.clearRect(0,0,this.containerSize[0],this.containerSize[1])}update(){this.updateRequestCount++,requestAnimationFrame(()=>{this.aSyncUpdateRequestCount++,this.aSyncUpdateRequestCount===this.updateRequestCount&&(this.updateRequestCount=this.aSyncUpdateRequestCount=0,this.reRender())})}reRender(){this.ctx.clearRect(0,0,this.containerSize[0],this.containerSize[1]);for(let t=0,e=this.shapeHeapArray.length;t<e;t++)this.ctx.save(),this.shapeHeapArray[t].render(this.ctx),this.ctx.restore()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(2);s.shapeConfig;class n extends s.Shape{constructor(t){super(t,"Custom"),this._draw=t.draw,this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{draw:this._draw})}drawPath(){return this.path=new Path2D,this._draw(a.drawTool.init(this.path,[this._x,this._y])),this}}e.Custom=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(2),n=i(5);class h extends s.shapeConfig{}e.triangleConfig=h;class r extends n.Polygon{constructor(t){super(t,"Triangle"),this._edge=t.edge,this.midEdge=this._edge/2,this.height=Math.sqrt(this._edge*this._edge-this.midEdge*this.midEdge),this._center=[this._x,this._y+this.height/2],this._vex=[[0,0],[-this.midEdge,this.height],[this.midEdge,this.height],[0,0]],this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{edge:this._edge})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee([[-this.midEdge,this.height],[this.midEdge,this.height],[0,0]]).end(),this}}e.Triangle=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class a extends s.shapeConfig{}e.circleConfig=a;class n extends s.Shape{constructor(t){super(t,"Circle"),this._center=[this._x,this._y],this._radius=t.radius,this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{radius:this._radius})}drawPath(){return this.path=new Path2D,this.path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}e.Circle=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(2),n=i(5);class h extends s.shapeConfig{}e.rectangleConfig=h;class r extends n.Polygon{constructor(t){super(t,"Rectangle"),this._width=t.edge[0],this._height=t.edge[1],this._center=[this._x+this._width/2,this._y+this._height/2],this._vex=[[0,0],[this._width,0],[this._width,this._height],[0,this._height],[0,0]],this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{edge:[this._width,this._height]})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y]).bee([[this._width,0],[this._width,this._height],[0,this._height],[0,0]]).end(),this}}e.Rectangle=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);s.shapeConfig;class a extends s.Shape{constructor(t){super(t,"Ellipse"),this._center=[this._x,this._y],this._radiusX=t.radius[0],this._radiusY=t.radius[1],this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{radius:[this._radiusX,this._radiusY]})}drawPath(){return this.path=new Path2D,this.path.ellipse(this._x,this._y,this._radiusX,this._radiusY,0,0,2*Math.PI,!0),this}}e.Ellipse=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),a=i(2);s.shapeConfig;class n extends s.Shape{constructor(t){super(t,"RoundRect"),this._width=t.edge[0],this._height=t.edge[1],this._round=t.round,this._center=[this._x+this._width/2,this._y+this._height/2+this._round],this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{edge:[this._width,this._height],round:this._round})}drawPath(){return this.path=new Path2D,a.drawTool.init(this.path,[this._x,this._y+this._round]).bee([[0,this._height-this._round]]).arc(this._round,180,90).bee([[this._width-this._round,this._height]]).arc(this._round,90,0).bee([[this._width,this._round]]).arc(this._round,0,-90).bee([[this._round,0]]).arc(this._round,-90,-180).end(),this}}e.RoundRect=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);s.shapeConfig;class a extends s.Shape{constructor(t){super(t,"Ring"),this._center=[this._x,this._y],this._radius=t.radius,this._width=t.width,this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{radius:this._radius,width:this._width})}drawPath(){return this.path=new Path2D,this.path.arc(this._x,this._y,this._radius+this._width,0,2*Math.PI,!1),this.path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}e.Ring=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);s.shapeConfig;class a extends s.Shape{constructor(t){super(t,"Sector"),this._center=[this._x,this._y],this._radius=t.radius,this._range=t.range,this.initSetter(),this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{radius:this._radius,range:this._range})}drawPath(){return this.path=new Path2D,this.path.moveTo(this._x,this._y),this.path.arc(this._x,this._y,this._radius,this._range[0]/180*Math.PI,this._range[1]/180*Math.PI),this.path.closePath(),this}}e.Sector=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);s.shapeConfig;class a extends s.Shape{constructor(t){super(t,"SVGPath"),this._svgPath=t.svgPath,this.createPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{svgPath:this._svgPath})}drawPath(){return this.path=new Path2D(this._svgPath),this}}e.SVGPath=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),a=i(0);class n extends a.Base{constructor(t){super(t,"Group"),this.count=0,this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.append(t)}),this.initSetter()}config(){return{shapes:this.shapeList,mounted:this._mounted,removed:this._removed,tag:this._tag,show:this._show,zIndex:this._zIndex}}setShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}getShapeList(){return this.shapeList}isShapeAt(t){return this.shapeList.some(e=>e.attr("id")===t.attr("id"))}append(t){t instanceof Array?t.map(t=>this.append(t)):(t.attr("show",this._show),this.shapeList.push(t),this.count+=t.getCount(),this.isMount&&this.layer.update())}remove(t){let e=t.attr("id");this.shapeList.map((t,i)=>{t.attr("id")===e&&this.shapeList.splice(i,1)}),this.count-=t.getCount(),this.isMount&&this.layer.update()}render(t){this._show&&s.DFS(this.shapeList,e=>{t.save(),e.render(t),t.restore()},!1)}}e.Group=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);s.shapeConfig;class a extends s.Shape{constructor(t){super(t,"Text"),this._maxWidth=t.maxWidth||null,this._fontSize=t.fontSize||10,this._content=t.content||"",this._align=t.align||"start",this._direction=t.dir||"inherit",this.font="px sans-serif",this._center=[],this.compositeCenter=[],this.compositeRotate=0,this.compositeScale=[1,1],this.tmpCtx=document.createElement("canvas").getContext("2d"),this.textWidth=this.tmpCtx.measureText(this._content).width,this.initSetter()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{content:this._content,fontSize:this._fontSize,align:this._align,dir:this._direction,maxWidth:this._maxWidth})}setterX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e}setterY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e}setterRotate(t){this.lastRotate!==t&&(this._rotate=t,this.lastRotate=this._rotate)}setterScale(t){this.lastScale.toString()!==t.toString()&&(this._scale=t,this.lastScale=this._scale)}setterContent(t){this._content=t,this.tmpCtx.font=this._fontSize+this.font,this.textWidth=this.tmpCtx.measureText(this._content).width}setCompositeRotate(t,e){this.compositeCenter=t,this.compositeRotate=e}setCompositeScale(t,e){this.compositeCenter=t,this.compositeScale=e}textRotate(t,e,i){t.translate(e[0],e[1]),t.rotate(i/180*Math.PI),t.translate(-e[0],-e[1])}textScale(t,e,i){t.translate(e[0],e[1]),t.scale(i[0],i[1]),t.translate(-e[0],-e[1])}drawPath(){return this}rotatePath(){return this}scalePath(){return this}render(t){this._show&&(this.compositeCenter.length&&(this.textRotate(t,this.compositeCenter,this.compositeRotate),this.textScale(t,this.compositeCenter,this.compositeScale)),this.textRotate(t,[this._x+this.textWidth,this._y-this._fontSize/2],this._rotate),this.textScale(t,[this._x+this.textWidth,this._y-this._fontSize/2],this._scale),t.font=this._fontSize+this.font,t.direction=this._direction,t.textAlign=this._align,t.textBaseline="top",t.globalAlpha=this._opacity,this._fill?(t.fillStyle=this._color,this._maxWidth?t.fillText(this._content,this._x,this._y,this._maxWidth):t.fillText(this._content,this._x,this._y)):(t.strokeStyle=this._color,this._maxWidth?t.strokeText(this._content,this._x,this._y,this._maxWidth):t.strokeText(this._content,this._x,this._y)))}getTextWidth(){return this.textWidth}getTextHeight(){return this._fontSize+2}}e.TextBlock=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class a extends s.shapeConfig{}e.lineConfig=a;class n extends s.Shape{constructor(t){super(t,"Line"),this._range=t.range,this._curveness=t.curveness||0,this._percent=void 0===t.percent?100:t.percent,this._fill=!1,this.initSetter(),this.createPath()}setterRange(t){this._range=t,this.drawPath()}config(){return Object.assign(Object.assign({},this.getBaseConfig()),{range:this._range,percent:this._percent,curveness:this._curveness})}drawPath(){if(this.path=new Path2D,this._curveness){let t=this._range[0],e=this._range[1],i=[(t[0]+e[0])/2-(t[1]-e[1])*this._curveness,(t[1]+e[1])/2-(e[0]-t[0])*this._curveness],s=this._percent/100,a=[i[0]-t[0],i[1]-t[1]],n=[e[0]-i[0],e[1]-i[1]],h=[t[0]+a[0]*s,t[1]+a[1]*s],r=[i[0]+n[0]*s,i[1]+n[1]*s],o=[r[0]-h[0],r[1]-h[1]],d=[h[0]+o[0]*s,h[1]+o[1]*s];this.path.moveTo(t[0],t[1]),this.path.quadraticCurveTo(h[0],h[1],d[0],d[1])}else{let t=this._range[1][0]-this._range[0][0],e=this._range[1][1]-this._range[0][1];this.path.moveTo(this._range[0][0],this._range[0][1]),this.path.lineTo(this._range[0][0]+this._percent/100*t,this._range[0][1]+this._percent/100*e)}return this}}e.Line=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.default=class{constructor(){this.animationHeap=[],this.isRun=!1}add(t){this.animationHeap.push(t),this.isRun||(this.isRun=!0,this.loop())}loop(){let t=0;this.animationHeap.map(e=>{e.state!==s.state.final&&(e.animationFrame(),t++)}),this.animationHeap.length&&this.animationHeap[0].state===s.state.final&&this.animationHeap.shift(),t?window.requestAnimationFrame(this.loop.bind(this)):this.isRun=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.eventInfo=class{};e.keyBoardEvent=class{};e.event=class{};e.EventSystem=class{constructor(t,e,i){this.eventList=["click","mousemove","keypress","mouseover","mouseout"],this.container=t,this.layerMap=e,this.containerLeft=i[0],this.containerTop=i[1],this.clickEventList=[],this.mouseoverEventList=[],this.mouseoutEventList=[],this.mousemoveEventList=[],this.mousedownEventList=[],this.mouseupEventList=[],this.keypressEventMap={},this.init()}init(){this.bindKeyBoardEvent(),this.bindMouseEvent()}omitEvent(t,e,i,s){e({target:t,x:i,y:s})}bindMouseEvent(){this.container.addEventListener("click",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.clickEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mousedown",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mousedownEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mouseup",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mouseupEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&this.omitEvent(t.shape,t.fn,e,i)})}),this.container.addEventListener("mousemove",t=>{let e=t.clientX-this.containerLeft,i=t.clientY-this.containerTop;this.mouseoutEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)||t.shape.isMouseIn()&&(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!1))}),this.mouseoverEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&(t.shape.isMouseIn()||(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!0)))}),this.mousemoveEventList.map(t=>{s.isInShape(t.ctx,t.shape,e,i)&&(this.omitEvent(t.shape,t.fn,e,i),t.shape.isMouseIn(!0))})})}bindKeyBoardEvent(){document.addEventListener("keydown",t=>{this.keypressEventMap[t.keyCode]&&this.keypressEventMap[t.keyCode].map(t=>{this.omitEvent(t.shape,t.fn.fn)})})}addEvent(t){t.ctx=this.layerMap[t.zIndex].getCTX(),"keypress"===t.eventName?(void 0===this.keypressEventMap[t.fn.keyCode]&&(this.keypressEventMap[t.fn.keyCode]=[]),this.keypressEventMap[t.fn.keyCode].push(t)):this[t.eventName+"EventList"].push(t)}delEvent(t){let e=null;"keypress"===t.eventName?(e=this.keypressEventMap[t.keyCode],e.map((i,s)=>{i.shape.attr("id")===t.shape.attr("id")&&e.splice(s,1)})):(e=this[t.eventName+"EventList"],e.map((i,s)=>{i.shape.attr("id")===t.shape.attr("id")&&e.splice(s,1)}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector={add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],dot:(t,e)=>t[0]*e[0]+t[1]*e[1],cor:(t,e)=>t[0]*e[1]-e[0]*t[1],pro(t,e){return this.dot(t,e)/this.len(e)},nor:t=>[t[1],-t[0]],len:t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),nol(t){let e=this.len(t);return 0!==e?[t[0]/e,t[1]/e]:[0,0]},scl:(t,e)=>[t*e[0],t*e[1]],inv:t=>[-t[0],-t[1]],eql:(t,e)=>t[0]===e[0]&&t[1]===e[1]}}])}));