var P2=function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={listenerTable:{},addListener(t,e){this.listenerTable[t]=e},notify(t,e){this.listenerTable[t](e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3),h=s(2),n=s(0);e.shapeConfig=class{};class r{constructor(t,e){this._id=Symbol(),this._type=e,this._isShow=!0,this._isMount=!1,this.count=1,this.event={},this._mounted=void 0!==t?t.mounted:()=>{},this._removed=void 0!==t?t.removed:()=>{}}id(){return this._id}type(){return this._type}isMount(t){if(void 0===t||"boolean"!=typeof t)return this._isMount;this._isMount=t,t?this.mounted():this.removed(),"group"!==this.type()&&"composite"!==this.type()||i.DFS(this.getShapeList(),e=>{e.isMount(t),t?e.mounted():e.removed()})}show(t){return void 0!==t&&"boolean"==typeof t?(this._isShow=t,"group"!==this.type()&&"composite"!==this.type()||i.DFS(this.getShapeList(),e=>{e.show(t)}),this._isMount&&n.default.notify("update"),this):this._isShow}getShapeList(){return null}config(){}getCount(){return this.count}mounted(){for(let t in this.event)n.default.notify("event",{shape:this,eventName:t,fn:this.event[t]});this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}draw(t,e){}}e.Base=r;e.Shape=class extends r{constructor(t,e){super(t,e),this._path=new Path2D,this._x=t.pin[0],this._y=t.pin[1],this._color=t.color,this._fill=void 0===t.fill||t.fill,this._rotate=t.rotate||0,this._transform=t.transform||[],this.originEventName={};for(let e in t)/^on./g.test(e)&&(this.originEventName[e]=t[e],this.bind(e.toLowerCase().substring(2),t[e]))}path(){return this._path}x(t){return void 0!==t&&"number"==typeof t?(this._x=t,this.drawPath(),this._isMount&&n.default.notify("update"),this):this._x}y(t){return void 0!==t&&"number"==typeof t?(this._y=t,this.drawPath(),this._isMount&&n.default.notify("update"),this):this._y}center(t){return void 0!==t&&t instanceof Array?(this._center=t,this):this._center}color(t){return void 0!==t&&"string"==typeof t?(this._color=t,this._isMount&&n.default.notify("update"),this):this._color}fill(t){return void 0!==t&&"boolean"==typeof t?(this._fill=t,this._isMount&&n.default.notify("update"),this):this._fill}rotate(t){return void 0!==t&&"number"==typeof t?(this._rotate=t,this.generatePath(),this._isMount&&n.default.notify("update"),this):this._rotate}transform(t){return void 0!==t&&t instanceof Array?(this._transform=t,this.generatePath(),this._isMount&&n.default.notify("update"),this):this._transform}getBaseConfig(){return Object.assign({pin:[this._x,this._y],center:this.center,color:this._color,fill:this._fill,rotate:this._rotate,transform:this._transform},this.originEventName,{mounted:this.mounted,removed:this.removed})}bind(t,e){this.event[t]=e}animate(t){}start(t){}end(t){}drawPath(){return this}generatePath(){let t=new Path2D;t.addPath(this._path,i.matrixMulti(i.rotate(h.Matrix.rotateMatrix,this._center,this._rotate),i.transform(h.Matrix.transformMatrix,this._center,this._transform),h.Matrix.resMatrix)),this._path=t}draw(t){this.show()&&(this._fill?(t.fillStyle=this._color,t.fill(this._path)):(t.strokeStyle=this._color,t.stroke(this._path)))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3),h=s(0),n=s(5),r=s(7),a=s(8),o=s(9),u=s(10),d=s(11),c=s(12);e.Matrix={rotateMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),transformMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),translateMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),resMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()};e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.count=0,this.ctx=t,this.canvasInfo=e,this.aSyncUpdateRequestCount=0,this.updateRequestCount=0}getCount(){return this.count}append(t){this.shapeHeapArray.push(t),t.isMount(!0),this.count+=t.getCount(),h.default.notify("update")}remove(t){let e=t.id();this.shapeHeapArray.map((t,s)=>{t.id()===e&&this.shapeHeapArray.splice(s,1)}),t.isMount(!1),this.count-=t.getCount(),h.default.notify("update")}clone(t){if("group"===t.type()){let s=new e.shapes.Group(t.config());return i.DFS(t.getShapeList(),t=>{s.append(this.clone(t))}),s}if("composite"===t.type()){let s=new e.shapes.Composite(t.config());return i.DFS(t.getShapeList(),t=>{s.join(this.clone(t))}),s}return new(e.shapes[t.type()])(t.config())}clear(){i.DFS(this.shapeHeapArray,t=>{t.isMount(!1)}),this.shapeHeapArray=[],this.count=0,this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height)}update(){this.updateRequestCount++,setTimeout(function(){this.aSyncUpdateRequestCount++,this.aSyncUpdateRequestCount===this.updateRequestCount&&(console.log("申请更新次数："+this.updateRequestCount),this.updateRequestCount=this.aSyncUpdateRequestCount=0,this.reRender())}.bind(this),0)}reRender(){this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height),this.shapeHeapArray.map(t=>{t.show()&&(this.ctx.save(),t.draw(this.ctx),this.ctx.restore())})}},e.shapes={Custom:n.Custom,Circle:a.Circle,Rectangle:o.Rectangle,Triangle:r.Triangle,Group:d.Group,Composite:c.Composite,Ellipse:u.Ellipse},e.utils={isInShape:i.isInShape,rotate:i.rotate,transform:i.transform}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DFS=function t(e,s){e.map(e=>{"group"===e.type()||"composite"===e.type()?(s(e),t(e.getShapeList(),s)):s(e)})},e.calcCenter=function(t){return[]},e.rotate=function(t,e,s){if(0===s)return null;let i=s/180*Math.PI;return t.a=Math.cos(i),t.c=-1*Math.sin(i),t.b=Math.sin(i),t.d=Math.cos(i),t.e=-e[0]*Math.cos(i)+e[1]*Math.sin(i)+e[0],t.f=-e[0]*Math.sin(i)-e[1]*Math.cos(i)+e[1],t},e.transform=function(t,e,s){return 0===s.length?null:(t.a=s[0][0],t.c=s[0][1],t.b=s[1][0],t.d=s[1][1],t.e=-e[0]*s[0][0]-e[1]*s[0][1]+e[0],t.f=-e[0]*s[1][0]-e[1]*s[1][1]+e[1],t)},e.matrixMulti=function(t,e,s){return null===t&&null===e?null:null===t&&null!==e?e:null!==t&&null===e?t:(s.a=t.a*e.a+t.c*e.b,s.b=t.b*e.a+t.d*e.b,s.c=t.a*e.c+t.c*e.d,s.d=t.b*e.c+t.d*e.d,s.e=t.a*e.e+t.c*e.f+t.e,s.f=t.b*e.e+t.d*e.f+t.f,s)},e.isInShape=function(t,e,s){}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),h=s(2),n=s(0),r=s(13);e.default=function(t,e){class s{constructor(t,e){this.ele=null,this.config={width:400,height:400,backgroundColor:"#eee"},this.ele=t,this.config=e||this.config,this.setWidth().setHeight().setBackgroundColor()}setWidth(){let t="fullWidth"===this.config.width?e.body.clientWidth:this.config.width;return this.ele.setAttribute("width",t.toString()),this.width=parseInt(t.toString()),this}setHeight(){let t="fullHeight"===this.config.height?e.body.clientHeight:this.config.height;return this.ele.setAttribute("height",t.toString()),this.height=parseInt(t.toString()),this}setBackgroundColor(){return this.ele.style.backgroundColor=this.config.backgroundColor,this}}return class{constructor(t,e){this.canvasEle=t,this.ctx=t.getContext("2d"),this.canvasStyle=new s(this.canvasEle,e),this.shapeHeap=new h.shapeHeap(this.ctx,{width:this.getWidth(),height:this.getHeight()}),this.eventSystem=new r.EventSystem(this.canvasEle),n.default.addListener("update",this.shapeHeap.update.bind(this.shapeHeap)),n.default.addListener("event",this.eventSystem.addEvent.bind(this.eventSystem)),this.shapes=i.shapes,this.utils=i.utils}getHeight(){return this.canvasStyle.height}getWidth(){return this.canvasStyle.width}getShapesCount(){return this.shapeHeap.getCount()}append(t){t instanceof Array?t.map(t=>this.shapeHeap.append(t)):this.shapeHeap.append(t)}remove(t){this.shapeHeap.remove(t)}clear(){this.shapeHeap.clear()}clone(t){return this.shapeHeap.clone(t)}}}(window,document)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(6);e.Custom=class extends i.Shape{constructor(t){super(t,"custom"),this._center=t.center,this._draw=t.draw,this.drawPath().generatePath()}config(){return Object.assign({},this.getBaseConfig(),{draw:this._draw})}drawPath(){return this._draw(this._path,h.line.init(this._path,[this._x,this._y])),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2);e.line=new class{constructor(){}init(t,e){return this.path=t,this.oX=e[0],this.oY=e[1],this.endX=this.oX,this.endY=this.oY,this.tPath=new Path2D,this}start(){return i.Matrix.translateMatrix.e=this.oX,i.Matrix.translateMatrix.f=this.oY,this.path.addPath(this.tPath,i.Matrix.translateMatrix),this.path.moveTo(this.endX,this.endY),this}bee(t){for(let e=0;e<t.length;e++)this.path.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,s){this.path.moveTo(this.endX,this.endY),this.path.bezierCurveTo(t[0],t[1],e[0],e[1],s[0],s[1]),this.endX=s[0],this.endY=s[1]}arc(t,e,s,i=!0){let h,n;return h=this.endX-t*Math.cos((360-e)/180*Math.PI),n=this.endY+t*Math.sin((360-e)/180*Math.PI),this.path.arc(h,n,t,e/180*Math.PI,s/180*Math.PI,i),this.endX=h-t*Math.cos((360-s)/180*Math.PI),this.endY=n+t*Math.sin((360-s)/180*Math.PI),this}end(){i.Matrix.translateMatrix.e=i.Matrix.translateMatrix.f=0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Triangle=class extends i.Shape{constructor(t){super(t,"triangle"),this._edge=t.edge,this.midEdge=this._edge/2,this.height=Math.sqrt(this._edge*this._edge-this.midEdge*this.midEdge),this._center=[this._x,this._y+this.height/2],this.drawPath().generatePath()}config(){return Object.assign({},this.getBaseConfig(),{edge:this._edge})}edge(t){return void 0!==t&&"number"==typeof t?(this._edge=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this._edge}drawPath(){return this._path.moveTo(this._x,this._y),this._path.lineTo(this._x-this.midEdge,this._y+this.height),this._path.lineTo(this._x+this.midEdge,this._y+this.height),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Circle=class extends i.Shape{constructor(t){super(t,"circle"),this._center=[this._x,this._y],this._radius=t.radius,this.drawPath().generatePath()}radius(t){return void 0!==t&&"number"==typeof t?(this._radius=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this._radius}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius})}drawPath(){return this._path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Rectangle=class extends i.Shape{constructor(t){super(t,"rectangle"),this._width=t.edge[0],this._height=t.edge[1],this.drawPath().generatePath()}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height]})}width(t){return void 0!==t&&"number"==typeof t?(this._width=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this._width}height(t){return void 0!==t&&"number"==typeof t?(this._height=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this._height}drawPath(){return this._center=[this._x+this._width/2,this._y+this._height/2],this._path.rect(this._x,this._y,this._width,this._height),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Ellipse=class extends i.Shape{constructor(t){super(t,"ellipse"),this._center=[this._x,this._y],this.radiusX=t.radius[0],this.radiusY=t.radius[1],this.drawPath().generatePath()}config(){return Object.assign({},this.getBaseConfig(),{radius:[this.radiusX,this.radiusY]})}rX(t){return void 0!==t&&"number"==typeof t?(this.radiusX=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this.radiusX}rY(t){return void 0!==t&&"number"==typeof t?(this.radiusY=t,this.drawPath(),this._isMount&&h.default.notify("update"),this):this.radiusY}drawPath(){return this._path.ellipse(this._x,this._y,this.radiusX,this.radiusY,this._rotate/180*Math.PI,0,2*Math.PI,!0),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Group=class extends i.Base{constructor(t){super(t,"group"),this.count=0,this.shapeList=new Array}config(){return{shapes:this.shapeList,mounted:this._mounted,removed:this._removed}}getShapeList(){return this.shapeList}append(t){this.shapeList.push(t),"group"===t.type()?this.count+=t.getCount():this.count+=1,this._isMount&&h.default.notify("update")}remove(t){let e=t.id();this.shapeList.map((t,s)=>{t.id()===e&&this.shapeList.splice(s,1)}),"group"===t.type()?this.count-=t.getCount():this.count-=1,this._isMount&&h.default.notify("update")}render(t,e){e.map(e=>{e.show()&&("group"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore()))})}draw(t){this.render(t,this.shapeList)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(0);e.Composite=class extends i.Shape{constructor(t){super(t,"composite"),this._center=t.center,this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.join(t)})}config(){return Object.assign({},this.getBaseConfig(),{shapes:this.shapeList})}x(t){if(void 0!==t&&"number"==typeof t){let e=t-this._x;return this._x=t,this.shapeList.map(t=>{t.x(t.x()+e)}),this._isMount&&h.default.notify("update"),this}return this._x}y(t){if(void 0!==t&&"number"==typeof t){let e=t-this._y;return this._y=t,this.shapeList.map(t=>{t.y(t.y()+e)}),this._isMount&&h.default.notify("UPDATE"),this}return this._y}rotate(t){return void 0!==t?(t&&(this._rotate=t),this.shapeList.map(e=>{let s=e.center();e.center(this._center).rotate(t),e.center(s)}),this._isMount&&h.default.notify("update"),this):this._rotate}transform(t){return void 0!==t?(t&&(this._transform=t),this._isMount&&h.default.notify("update"),this):this._transform}getShapeList(){return this.shapeList}join(t){if("group"===t.type())return void console.warn("group类型不能加入composite");let e=t.center();t.center(this._center).rotate(this._rotate),t.center(e),this.shapeList.push(t),this._isMount&&h.default.notify("update")}render(t,e){e.map(e=>{"composite"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore())})}draw(t){this.render(t,this.getShapeList())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.bindInfo=class{};e.keyBoardEvent=class{};e.event=class{};e.EventSystem=class{constructor(t){this.eventList=["click","mouseover","mouseout","mousemove","mousedown","mouseup"],this.canvasEle=t,this.clickEventList=[],this.mouseoverEventList=[],this.mouseoutEventList=[],this.mousemoveEventList=[],this.mousedownEventList=[],this.mouseupEventList=[],this.keypressEventMap={},this.init(this.canvasEle)}init(t){this.eventList.map(e=>{"keypress"===e?t.addEventListener("keydown",t=>{this[e+"EventMap"][t.keyCode].map(t=>{t.fn.fn({curShape:t.shape,x:0,y:0})})}):t.addEventListener(e,t=>{this[e+"EventList"].map(t=>{t.fn({curShape:t.shape,x:0,y:0})})})})}addEvent(t){"keypress"===t.eventName?(void 0===this.keypressEventMap[t.fn.keyCode]&&(this.keypressEventMap[t.fn.keyCode]=[]),this.keypressEventMap[t.fn.keyCode].push(t)):this[t.eventName+"EventList"].push(t)}}}]);