var P2=function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.broadcast={notifyCount:Number,taskCount:Number,listener:Function,init(t){this.notifyCount=0,this.taskCount=0,this.listener=t},notify(){this.notifyCount++,setTimeout(function(){this.taskCount++,this.taskCount===this.notifyCount&&(console.log("申请更新次数："+this.notifyCount),this.taskCount=this.notifyCount=0,this.listener())}.bind(this),0)}},e.DFS=function t(e,i){e.map(e=>{"group"===e.type()||"composite"===e.type()?(i(e),t(e.getShapeList(),i)):i(e)})},e.calcCenter=function(t){return[]},e.rotate=function(t,e,i){t.translate(e[0],e[1]),t.rotate(i/180*Math.PI),t.translate(-e[0],-e[1])}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.shapeConfig=class{};class o{constructor(t,e){this._id=Symbol(),this._type=e,this._isShow=!0,this._isMount=!1,this.count=1,this._mounted=void 0!==t?t.mounted:()=>{},this._removed=void 0!==t?t.removed:()=>{}}id(){return this._id}type(){return this._type}isMount(t){if(void 0===t||"boolean"!=typeof t)return this._isMount;this._isMount=t,t?this.mounted():this.removed(),"group"!==this.type()&&"composite"!==this.type()||s.DFS(this.getShapeList(),e=>{e.isMount(t),t?e.mounted():e.removed()})}show(t){return void 0!==t&&"boolean"==typeof t?(this._isShow=t,"group"!==this.type()&&"composite"!==this.type()||s.DFS(this.getShapeList(),e=>{e.show(t)}),this._isMount&&s.broadcast.notify(),this):this._isShow}getShapeList(){return null}config(){}getCount(){return this.count}mounted(){this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}draw(t){}}e.base=o;e.shape=class extends o{constructor(t,e){super(t,e),this._x=t.pin[0],this._y=t.pin[1],this._color=t.color,this._fill=void 0===t.fill||t.fill,this._rotate=t.rotate||0}x(t){return void 0!==t&&"number"==typeof t?(this._x=t,this._isMount&&s.broadcast.notify(),this):this._x}y(t){return void 0!==t&&"number"==typeof t?(this._y=t,this._isMount&&s.broadcast.notify(),this):this._y}color(t){return void 0!==t&&"string"==typeof t?(this._color=t,this._isMount&&s.broadcast.notify(),this):this._color}fill(t){return void 0!==t&&"boolean"==typeof t?(this._fill=t,this._isMount&&s.broadcast.notify(),this):this._fill}rotate(t){return void 0!==t&&"number"==typeof t?(this._rotate=t,this._isMount&&s.broadcast.notify(),this):this._rotate}getBaseConfig(){return{pin:[this._x,this._y],color:this._color,fill:this._fill,rotate:this._rotate}}bind(){}animate(t){}start(t){}end(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),o=i(4),h=i(6),r=i(7),n=i(8),a=i(9),c=i(10);e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.count=0,this.ctx=t,this.canvasInfo=e}getCount(){return this.count}append(t){this.shapeHeapArray.push(t),t.isMount(!0),this.count+=t.getCount(),s.broadcast.notify()}remove(t){let e=t.id();this.shapeHeapArray.map((t,i)=>{t.id()===e&&this.shapeHeapArray.splice(i,1)}),t.isMount(!1),this.count-=t.getCount(),s.broadcast.notify()}clone(t){if("group"===t.type()){let i=new e.shapes.group(t.config());return s.DFS(t.getShapeList(),t=>{i.append(this.clone(t))}),i}if("composite"===t.type()){let i=new e.shapes.composite(t.config());return s.DFS(t.getShapeList(),t=>{i.join(this.clone(t))}),i}return new(e.shapes[t.type()])(t.config())}clear(){s.DFS(this.shapeHeapArray,t=>{t.isMount(!1)}),this.shapeHeapArray=[],this.count=0,this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height)}reRender(){this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height),this.shapeHeapArray.map(t=>{t.show()&&(this.ctx.save(),t.draw(this.ctx),this.ctx.restore())})}},e.shapes={custom:o.custom,circle:r.circle,rectangle:n.rectangle,triangle:h.triangle,group:a.group,composite:c.composite}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),o=i(2),h=i(0);e.default=function(t,e){class i{constructor(t,e){this.ele=null,this.config={width:400,height:400,backgroundColor:"#eee"},this.ele=t,this.config=e||this.config,this.setWidth().setHeight().setBackgroundColor()}setWidth(){let t="fullWidth"===this.config.width?e.body.clientWidth:this.config.width;return this.ele.setAttribute("width",t.toString()),this.width=parseInt(t.toString()),this}setHeight(){let t="fullHeight"===this.config.height?e.body.clientHeight:this.config.height;return this.ele.setAttribute("height",t.toString()),this.height=parseInt(t.toString()),this}setBackgroundColor(){return this.ele.style.backgroundColor=this.config.backgroundColor,this}}return class{constructor(t,e){this.ctx=t.getContext("2d"),this.canvasStyle=new i(t,e),this.shapeHeap=new o.shapeHeap(this.ctx,{width:this.getWidth(),height:this.getHeight()}),h.broadcast.init(this.shapeHeap.reRender.bind(this.shapeHeap)),this.shapes=s.shapes}getHeight(){return this.canvasStyle.height}getWidth(){return this.canvasStyle.width}getShapesCount(){return this.shapeHeap.getCount()}append(t){t instanceof Array?t.map(t=>this.shapeHeap.append(t)):this.shapeHeap.append(t)}remove(t){this.shapeHeap.remove(t)}clear(){this.shapeHeap.clear()}clone(t){return this.shapeHeap.clone(t)}}}(window,document)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(5),h=i(0);e.custom=class extends s.shape{constructor(t){super(t,"custom"),this.center=t.center,this._draw=t.draw}config(){return Object.assign({},this.getBaseConfig(),{center:this.center,draw:this._draw})}draw(t){h.rotate(t,[this.center[0],this.center[1]],this._rotate),this._draw(t,o.line.init(t,this))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.line=new class{constructor(){}init(t,e){return this.ctx=t,this.oX=e.x(),this.oY=e.y(),this.color=e.color(),this.fill=e.fill(),this}start(t){return this.endX=t[0],this.endY=t[1],this.ctx.translate(this.oX,this.oY),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.moveTo(this.endX,this.endY),this}bee(t){for(let e=0;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,i){this.ctx.moveTo(this.endX,this.endY),this.ctx.bezierCurveTo(t[0],t[1],e[0],e[1],i[0],i[1]),this.endX=i[0],this.endY=i[1]}arc(t,e,i,s=!0){let o,h;return o=this.endX-t*Math.cos((360-e)/180*Math.PI),h=this.endY+t*Math.sin((360-e)/180*Math.PI),this.ctx.arc(o,h,t,e/180*Math.PI,i/180*Math.PI,s),this.endX=o-t*Math.cos((360-i)/180*Math.PI),this.endY=h+t*Math.sin((360-i)/180*Math.PI),this}end(){this.fill?this.ctx.fill():this.ctx.stroke()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);e.triangle=class extends s.shape{constructor(t){super(t,"triangle"),this._edge=t.edge}config(){return Object.assign({},this.getBaseConfig(),{edge:this._edge})}edge(t){return void 0!==t&&"number"==typeof t?(this._edge=t,this._isMount&&o.broadcast.notify(),this):this._edge}draw(t){let e=this._edge/2,i=Math.sqrt(this._edge*this._edge-e*e);o.rotate(t,[this._x,this._y+i/2],this._rotate),t.beginPath(),t.moveTo(this._x,this._y),t.lineTo(this._x-e,this._y+i),t.lineTo(this._x+e,this._y+i),this._fill?(t.fillStyle=this._color,t.fill()):(t.strokeStyle=this._color,t.closePath(),t.stroke())}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);e.circle=class extends s.shape{constructor(t){super(t,"circle"),this._radius=t.radius}radius(t){return void 0!==t&&"number"==typeof t?(this._radius=t,this._isMount&&o.broadcast.notify(),this):this._radius}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius})}draw(t){t.beginPath(),t.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this._fill?(t.fillStyle=this._color,t.fill()):(t.strokeStyle=this._color,t.stroke())}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);e.rectangle=class extends s.shape{constructor(t){super(t,"rectangle"),this._width=t.edge[0],this._height=t.edge[1]}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height]})}width(t){return void 0!==t&&"number"==typeof t?(this._width=t,this._isMount&&o.broadcast.notify(),this):this._width}height(t){return void 0!==t&&"number"==typeof t?(this._height=t,this._isMount&&o.broadcast.notify(),this):this._height}draw(t){o.rotate(t,[this._x+this._width/2,this._y+this._height/2],this._rotate),this._fill?(t.fillStyle=this._color,t.fillRect(this._x,this._y,this._width,this._height)):(t.strokeStyle=this._color,t.strokeRect(this._x,this._y,this._width,this._height))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);e.group=class extends s.base{constructor(t){super(t,"group"),this.count=0,this.shapeList=new Array}config(){return{mounted:this._mounted,removed:this._removed}}getShapeList(){return this.shapeList}append(t){this.shapeList.push(t),"group"===t.type()?this.count+=t.getCount():this.count+=1,this._isMount&&o.broadcast.notify()}remove(t){let e=t.id();this.shapeList.map((t,i)=>{t.id()===e&&this.shapeList.splice(i,1)}),"group"===t.type()?this.count-=t.getCount():this.count-=1,this._isMount&&o.broadcast.notify()}render(t,e){e.map(e=>{e.show()&&("group"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore()))})}draw(t){this.render(t,this.shapeList)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);e.composite=class extends s.base{constructor(t){super(t,"composite"),this._x=t.pin[0],this._y=t.pin[1],this._rotate=t.rotate||0,this.center=t.center,this.shapeList=[]}config(){return{pin:[this._x,this._y],rotate:this._rotate,center:this.center,mounted:this._mounted,removed:this._removed}}x(t){if(void 0!==t&&"number"==typeof t){let e=t-this._x;return this._x=t,this.shapeList.map(t=>{t.x(t.x()+e)}),this._isMount&&o.broadcast.notify(),this}return this._x}y(t){if(void 0!==t&&"number"==typeof t){let e=t-this._y;return this._y=t,this.shapeList.map(t=>{t.y(t.y()+e)}),this._isMount&&o.broadcast.notify(),this}return this._y}getShapeList(){return this.shapeList}join(t){"group"!==t.type()?(this.shapeList.push(t),this._isMount&&o.broadcast.notify()):console.warn("group类型不能加入composite")}render(t,e){this.shapeList.map(e=>{e.show()&&("composite"===e.type()?this.render(t,e.getShapeList()):(t.save(),e.draw(t),t.restore()))})}draw(t){o.rotate(t,[this.center[0],this.center[1]],this._rotate),this.render(t,this.shapeList)}}}]);