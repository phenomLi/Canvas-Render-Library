var P2=function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=5)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4),h=s(1),r=s(2);e.shapeConfig=class{};class a{constructor(t,e){this._id=Symbol(),this._type=e,this._show=!0,this.isMount=!1,this.count=1,this.writableProperties=[],this.readonlyProperties=["id","type"],this.readableProperties=[]}initSetter(){this.readableProperties=this.readableProperties.concat(this.readonlyProperties,this.writableProperties),this.writableProperties.map(t=>{let e=t.substring(0,1).toUpperCase()+t.substring(1);void 0===this[`set${e}`]&&(this[`set${e}`]=function(e){this[`_${t}`]=e,this.notRePathProperties.includes(t)||this.drawPath().rotatePath().transFormPath()})})}attr(t,e){if(this.readableProperties.includes(t))return void 0!==e?(this.writableProperties.includes(t)?(this[`set${t.substring(0,1).toUpperCase()+t.substring(1)}`](e),this.isMount&&r.default.notify("update")):console.warn(`${t}不能被修改`),this):this[`_${t}`];console.warn(`${t}属性不存在`)}toggleMount(t){this.isMount=t,t?this.mounted():this.removed(),"Group"!==this.attr("type")&&"Composite"!==this.attr("type")||i.DFS(this.getShapeList(),e=>{e.toggleMount(t),t?e.mounted():e.removed()})}getShapeList(){return null}getCount(){return this.count}config(){}mounted(){this._mounted&&"function"==typeof this._mounted&&this._mounted()}removed(){this._removed&&"function"==typeof this._removed&&this._removed()}drawPath(){return null}rotatePath(){return null}transFormPath(){return null}renderPath(t){}}e.Base=a;e.Shape=class extends a{constructor(t,e){super(t,e),this._x=t.pin[0],this._y=t.pin[1],this._color=t.color,this._fill=void 0===t.fill||t.fill,this._opacity=t.opacity||1,this._rotate=t.rotate||0,this._transform=t.transform||[],this._mounted=t.mounted||(()=>{}),this._removed=t.removed||(()=>{}),this._fillRule=!0,this.isMouseIn=!1,this.originEventName={},this.writableProperties=["x","y","color","fill","opacity","rotate","transform","show"],this.readonlyProperties.push("center"),this.notRePathProperties=["color","fill","opacity","show"];for(let e in t)/^on./g.test(e)&&(this.originEventName[e]=t[e],this.bind(e.toLowerCase().substring(2),t[e]))}getBaseConfig(){return Object.assign({pin:[this._x,this._y],center:this._center,color:this._color,fill:this._fill,rotate:this._rotate,transform:this._transform},this.originEventName,{mounted:this._mounted,removed:this._removed})}getPath(){return this.path}setPath(t){this.path=t}setX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.drawPath().rotatePath().transFormPath()}setY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.drawPath().rotatePath().transFormPath()}bind(t,e){r.default.notify("event",{shape:this,eventName:t,fn:e.bind(this)})}animate(t){}start(t){}end(t){}drawPath(t){return this}rotatePath(t){if("circle"===this._type||"ellipse"===this._type)return this;let e=new Path2D;return e.addPath(this.path,i.rotate(h.Matrix.rotateMatrix,this._center,this._rotate)),this.path=e,this}transFormPath(t){let e=new Path2D;return e.addPath(this.path,i.transform(h.Matrix.transformMatrix,this._center,this._transform)),this.path=e,this}renderPath(t){this.attr("show")&&(t.globalAlpha=this._opacity,this._fill?(t.fillStyle=this._color,t.fill(this.path,this._fillRule?"nonzero":"evenodd")):(t.strokeStyle=this._color,t.stroke(this.path)))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4),h=s(2),r=s(6),a=s(7),n=s(8),o=s(9),u=s(10),d=s(11),c=s(12),p=s(13);e.Matrix={rotateMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),transformMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),translateMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()};e.shapeHeap=class{constructor(t,e){this.shapeHeapArray=new Array,this.count=0,this.ctx=t,this.canvasInfo=e,this.aSyncUpdateRequestCount=0,this.updateRequestCount=0}getCount(){return this.count}append(t){this.shapeHeapArray.push(t),t.toggleMount(!0),this.count+=t.getCount(),h.default.notify("update")}remove(t){let e=t.attr("id");this.shapeHeapArray.map((t,s)=>{t.attr("id")===e&&this.shapeHeapArray.splice(s,1)}),t.toggleMount(!1),this.count-=t.getCount(),h.default.notify("update")}clone(t){if("Group"===t.attr("type")){let s=new e.shapes.Group(t.config());return i.DFS(t.getShapeList(),t=>{s.append(this.clone(t))}),s}if("Composite"===t.attr("type")){let s=new e.shapes.Composite(t.config());return i.DFS(t.getShapeList(),t=>{s.join(this.clone(t))}),s}return new(e.shapes[t.attr("type")])(t.config())}clear(){this.shapeHeapArray.map(t=>{t.toggleMount(!1)}),this.shapeHeapArray=[],this.count=0,this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height)}update(){this.updateRequestCount++,setTimeout(function(){this.aSyncUpdateRequestCount++,this.aSyncUpdateRequestCount===this.updateRequestCount&&(console.log("申请更新次数："+this.updateRequestCount),this.updateRequestCount=this.aSyncUpdateRequestCount=0,this.reRender())}.bind(this),0)}reRender(){this.ctx.clearRect(0,0,this.canvasInfo.width,this.canvasInfo.height),this.shapeHeapArray.map(t=>{t.attr("show")&&(this.ctx.save(),t.renderPath(this.ctx),this.ctx.restore())})}},e.shapes={Custom:r.Custom,Circle:n.Circle,Rectangle:o.Rectangle,Triangle:a.Triangle,Group:c.Group,Composite:p.Composite,Ellipse:u.Ellipse,RoundRect:d.RoundRect},e.utils={isInShape:i.isInShape}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={listenerTable:{},addListener(t,e){this.listenerTable[t]=e},notify(t,e){return this.listenerTable[t](e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.line=new class{constructor(){}init(t,e){return this.path=t,this.oX=e[0],this.oY=e[1],this.endX=this.oX,this.endY=this.oY,this.tPath=new Path2D,i.Matrix.translateMatrix.e=this.oX,i.Matrix.translateMatrix.f=this.oY,this.tPath.moveTo(0,0),this}bee(t){for(let e=0;e<t.length;e++)this.tPath.lineTo(t[e][0],t[e][1]);return this.endX=t[t.length-1][0],this.endY=t[t.length-1][1],this}bez(t,e,s){this.tPath.moveTo(this.endX,this.endY),this.tPath.bezierCurveTo(t[0],t[1],e[0],e[1],s[0],s[1]),this.endX=s[0],this.endY=s[1]}arc(t,e,s,i=!0){let h,r;return h=this.endX-t*Math.cos((360-e)/180*Math.PI),r=this.endY+t*Math.sin((360-e)/180*Math.PI),this.tPath.arc(h,r,t,e/180*Math.PI,s/180*Math.PI,i),this.endX=h-t*Math.cos((360-s)/180*Math.PI),this.endY=r+t*Math.sin((360-s)/180*Math.PI),this}move(t,e){this.tPath.moveTo(t,e),this.endX=t,this.endY=e}end(){this.path.addPath(this.tPath,i.Matrix.translateMatrix),i.Matrix.translateMatrix.e=i.Matrix.translateMatrix.f=0}}},function(t,e,s){"use strict";function i(t,e,s=!0){t.map(t=>{"Group"===t.attr("type")||"Composite"===t.attr("type")?(s&&e(t),i(t.getShapeList(),e)):e(t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.DFS=i,e.calcCenter=function(t){return[]},e.rotate=function(t,e,s){let i=s/180*Math.PI;return t.a=Math.cos(i),t.c=-1*Math.sin(i),t.b=Math.sin(i),t.d=Math.cos(i),t.e=-e[0]*Math.cos(i)+e[1]*Math.sin(i)+e[0],t.f=-e[0]*Math.sin(i)-e[1]*Math.cos(i)+e[1],t},e.transform=function(t,e,s){return 0===s.length?null:(t.a=s[0][0],t.c=s[0][1],t.b=s[1][0],t.d=s[1][1],t.e=-e[0]*s[0][0]-e[1]*s[0][1]+e[0],t.f=-e[0]*s[1][0]-e[1]*s[1][1]+e[1],t)},e.matrixMulti=function(t,e,s){return null===t&&null===e?null:null===t&&null!==e?e:null!==t&&null===e?t:(s.a=t.a*e.a+t.c*e.b,s.b=t.b*e.a+t.d*e.b,s.c=t.a*e.c+t.c*e.d,s.d=t.b*e.c+t.d*e.d,s.e=t.a*e.e+t.c*e.f+t.e,s.f=t.b*e.e+t.d*e.f+t.f,s)},e.isInShape=function(t,e,s,h){if("Composite"===e.attr("type")){let r=!1;return i(e.getShapeList(),e=>{t.isPointInPath(e.getPath(),s,h)&&(r=!0)},!1),r}return t.isPointInPath(e.getPath(),s,h)},e.isInPath=function(t,e,s,i){return t.isPointInStroke(e,s,i)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),h=s(1),r=s(2),a=s(14);e.default=function(t,e){class s{constructor(t,e){this.ele=null,this.config={width:400,height:400,backgroundColor:"#eee"},this.ele=t,this.config=e||this.config,this.setWidth().setHeight().setBackgroundColor()}setWidth(){let t="fullWidth"===this.config.width?e.body.clientWidth:this.config.width;return this.ele.setAttribute("width",t.toString()),this.width=parseInt(t.toString()),this}setHeight(){let t="fullHeight"===this.config.height?e.body.clientHeight:this.config.height;return this.ele.setAttribute("height",t.toString()),this.height=parseInt(t.toString()),this}setBackgroundColor(){return this.ele.style.backgroundColor=this.config.backgroundColor,this}}return class{constructor(t,e){this.canvasEle=t,this.ctx=t.getContext("2d"),this.canvasStyle=new s(this.canvasEle,e),this.shapeHeap=new h.shapeHeap(this.ctx,{width:this.getWidth(),height:this.getHeight()}),this.eventSystem=new a.EventSystem(this.canvasEle,this.ctx),r.default.addListener("update",this.shapeHeap.update.bind(this.shapeHeap)),r.default.addListener("clone",this.shapeHeap.clone.bind(this.shapeHeap)),r.default.addListener("event",this.eventSystem.addEvent.bind(this.eventSystem)),this.shapes=i.shapes,this.utils=i.utils}getHeight(){return this.canvasStyle.height}getWidth(){return this.canvasStyle.width}getShapesCount(){return this.shapeHeap.getCount()}append(t){t instanceof Array?t.map(t=>this.shapeHeap.append(t)):this.shapeHeap.append(t)}remove(t){this.shapeHeap.remove(t)}clear(){this.shapeHeap.clear()}clone(t){return this.shapeHeap.clone(t)}}}(window,document)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(3);e.Custom=class extends i.Shape{constructor(t){super(t,"Custom"),this._center=t.center,this._fillRule=t.fillRule||!0,this._draw=t.draw,this.initSetter(),this.drawPath().rotatePath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{draw:this._draw})}drawPath(){return this.path=new Path2D,this._draw(this.path,h.line.init(this.path,[this._x,this._y])),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(3);e.Triangle=class extends i.Shape{constructor(t){super(t,"Triangle"),this._edge=t.edge,this.midEdge=this._edge/2,this.height=Math.sqrt(this._edge*this._edge-this.midEdge*this.midEdge),this._center=[this._x,this._y+this.height/2],this.writableProperties.push("edge"),this.initSetter(),this.drawPath().rotatePath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:this._edge})}drawPath(){return this.path=new Path2D,h.line.init(this.path,[this._x,this._y]).bee([[-this.midEdge,this.height],[this.midEdge,this.height],[0,0]]).end(),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.Circle=class extends i.Shape{constructor(t){super(t,"Circle"),this._center=[this._x,this._y],this._radius=t.radius,this.writableProperties.push("radius"),this.initSetter(),this.drawPath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:this._radius})}drawPath(){return this.path=new Path2D,this.path.arc(this._x,this._y,this._radius,0,2*Math.PI,!0),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(3);e.Rectangle=class extends i.Shape{constructor(t){super(t,"Rectangle"),this._width=t.edge[0],this._height=t.edge[1],this._center=[this._x+this._width/2,this._y+this._height/2],this.writableProperties.push("width"),this.writableProperties.push("height"),this.initSetter(),this.drawPath().rotatePath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height]})}drawPath(){return this.path=new Path2D,h.line.init(this.path,[this._x,this._y]).bee([[this._width,0],[this._width,this._height],[0,this._height],[0,0]]).end(),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.Ellipse=class extends i.Shape{constructor(t){super(t,"Ellipse"),this._center=[this._x,this._y],this._radiusX=t.radius[0],this._radiusY=t.radius[1],this.initSetter(),this.drawPath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{radius:[this._radiusX,this._radiusY]})}setRadiusX(t){this._radiusX=t,this.drawPath().transFormPath()}setRadiusY(t){this._radiusY=t,this.drawPath().transFormPath()}setRotate(t){this._rotate=t,this.drawPath().transFormPath()}drawPath(){return this.path=new Path2D,this.path.ellipse(this._x,this._y,this._radiusX,this._radiusY,this._rotate/180*Math.PI,0,2*Math.PI,!0),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(3);e.RoundRect=class extends i.Shape{constructor(t){super(t,"Roundrect"),this._width=t.edge[0],this._height=t.edge[1],this._round=t.round,this._center=[this._x+this._width/2,this._y+this._height/2+this._round],this.writableProperties.push("width"),this.writableProperties.push("height"),this.writableProperties.push("round"),this.initSetter(),this.drawPath().rotatePath().transFormPath()}config(){return Object.assign({},this.getBaseConfig(),{edge:[this._width,this._height],round:this._round})}drawPath(){return this.path=new Path2D,h.line.init(this.path,[this._x,this._y+this._round]).bee([[0,this._height-this._round]]).arc(this._round,180,90).bee([[this._width-this._round,this._height]]).arc(this._round,90,0).bee([[this._width,this._round]]).arc(this._round,0,-90).bee([[this._round,0]]).arc(this._round,-90,-180).end(),this}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(2),r=s(4);e.Group=class extends i.Base{constructor(t){super(t,"Group"),this._mounted=void 0!==t?t.mounted:()=>{},this._removed=void 0!==t?t.removed:()=>{},this.count=0,this.shapeList=[],this.writableProperties=["show"],t&&t.shapes&&t.shapes.map(t=>{this.append(t)}),this.initSetter()}config(){return{shapes:this.shapeList,mounted:this._mounted,removed:this._removed}}setShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}getShapeList(){return this.shapeList}append(t){t instanceof Array?t.map(t=>this.append(t)):(this.shapeList.push(t),this.count+=t.getCount(),this.isMount&&h.default.notify("update"))}remove(t){let e=t.attr("id");this.shapeList.map((t,s)=>{t.attr("id")===e&&this.shapeList.splice(s,1)}),this.count-=t.getCount(),this.isMount&&h.default.notify("update")}renderPath(t){r.DFS(this.shapeList,e=>{e.attr("show")&&(t.save(),e.renderPath(t),t.restore())},!1)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),h=s(2),r=s(4),a=s(1);e.Composite=class extends i.Shape{constructor(t){super(t,"Composite"),this.deep=void 0===t.deep||t.deep,this._center=t.center,this.writableProperties=["x","y","center","rotate","transform","show"],this.shapeList=[],t&&t.shapes&&t.shapes.map(t=>{this.join(t,this.deep)}),this.initSetter()}join(t,e){if(t instanceof Array)t.map(t=>this.join(t,e));else{if("Group"===t.attr("type"))return void console.warn("group类型不能加入composite");this.shapeList.push(this.shapeProcessor(e?h.default.notify("clone",t):t)),this.isMount&&h.default.notify("update")}}config(){return Object.assign({},this.getBaseConfig(),{shapes:this.shapeList})}setX(t){let e=t-this._x;this._x=t,this._center[0]=this._center[0]+e,this.shapeList.map(t=>{t.attr("x",t.attr("x")+e),this.shapeProcessor(t)})}setY(t){let e=t-this._y;this._y=t,this._center[1]=this._center[1]+e,this.shapeList.map(t=>{t.attr("y",t.attr("y")+e),this.shapeProcessor(t)})}setShow(t){this._show=t,this.shapeList.map(e=>{e.attr("show",t)})}setRotate(t){this._rotate=t,r.DFS(this.getShapeList(),t=>{t.drawPath().rotatePath().transFormPath()},!1),this.shapeList.map(t=>{this.rotatePath(t)})}setTransform(t){return r.DFS(this.getShapeList(),t=>{t.drawPath().rotatePath().transFormPath()},!1),this.shapeList.map(t=>{this.transFormPath(t)}),this}getShapeList(){return this.shapeList}shapeProcessor(t){return this._rotate&&this.rotatePath(t),this._transform&&this.transFormPath(t),t}rotatePath(t){if("Composite"===t.attr("type"))r.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),r.rotate(a.Matrix.rotateMatrix,this._center,this._rotate)),t.setPath(e)},!1);else{let e=new Path2D;e.addPath(t.getPath(),r.rotate(a.Matrix.rotateMatrix,this._center,this._rotate)),t.setPath(e)}return this}transFormPath(t){if("Composite"===t.attr("type"))r.DFS(t.getShapeList(),t=>{let e=new Path2D;e.addPath(t.getPath(),r.transform(a.Matrix.transformMatrix,this._center,this._transform)),t.setPath(e)},!1);else{let e=new Path2D;e.addPath(t.getPath(),r.transform(a.Matrix.transformMatrix,this._center,this._transform)),t.setPath(e)}return this}renderPath(t){r.DFS(this.shapeList,e=>{t.save(),e.renderPath(t),t.restore()},!1)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4);e.bindInfo=class{};e.keyBoardEvent=class{};e.event=class{};e.EventSystem=class{constructor(t,e){this.eventList=["click","mousemove","keypress","mouseover","mouseout"],this.canvasEle=t,this.canvasLeft=t.getBoundingClientRect().left,this.canvasTop=this.canvasEle.getBoundingClientRect().top,this.ctx=e,this.clickEventList=[],this.mouseoverEventList=[],this.mouseoutEventList=[],this.mousemoveEventList=[],this.keypressEventMap={},this.init()}init(){this.bindKeyBoardEvent(),this.bindMouseEvent()}omitEvent(t,e,s){t.fn({target:t.shape,x:e,y:s})}bindMouseEvent(){this.canvasEle.addEventListener("click",t=>{let e=t.clientX-this.canvasLeft,s=t.clientY-this.canvasTop;this.clickEventList.map(t=>{i.isInShape(this.ctx,t.shape,e,s)&&this.omitEvent(t,e,s)})}),this.canvasEle.addEventListener("mousemove",t=>{let e=t.clientX-this.canvasLeft,s=t.clientY-this.canvasTop;this.mouseoverEventList.map(t=>{i.isInShape(this.ctx,t.shape,e,s)&&(t.shape.isMouseIn||(this.omitEvent(t,e,s),t.shape.isMouseIn=!0))}),this.mouseoutEventList.map(t=>{i.isInShape(this.ctx,t.shape,e,s)||t.shape.isMouseIn&&(this.omitEvent(t,e,s),t.shape.isMouseIn=!1)}),this.mousemoveEventList.map(t=>{i.isInShape(this.ctx,t.shape,e,s)&&(this.omitEvent(t,e,s),t.shape.isMouseIn=!0)})})}bindKeyBoardEvent(){this.canvasEle.addEventListener("keydown",t=>{this.keypressEventMap[t.keyCode].map(t=>{this.omitEvent(t)})})}addEvent(t){"keypress"===t.eventName?(void 0===this.keypressEventMap[t.fn.keyCode]&&(this.keypressEventMap[t.fn.keyCode]=[]),this.keypressEventMap[t.fn.keyCode].push(t)):this[t.eventName+"EventList"].push(t)}}}]);