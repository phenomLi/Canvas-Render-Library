<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
<style>
* {
    padding: 0;
    margin: 0;
}
</style>
</head>
<body>
    

<canvas id="canvas" style="background-color: #eee">
</canvas>

<div>
    <button id="btn">点击</button>
</div>


<script src="./dist/bundle.js"></script>
<script>


const prender = P2.default;

const p = new prender(document.getElementById("canvas"), {
    width: 'fullWidth',
    height: 500
});


let clickFlag = true;



const rr1 = new p.shapes.RoundRect({
    pin: [200, 200],
    color: 'green',
    round: 30,
    edge: [160, 160],
    onMouseOver: function(e) {
        this.attr('color', 'red');
    },
    onMouseOut: function(e) {
        this.attr('color', 'green');
    },
    onClick: function(e) {
        this.attr('rotate', clickFlag? 45: 0);
        clickFlag = !clickFlag;
    },
    onKeyPress: [{
        keyCode: 39,
        fn: function(e) {
            this.attr('x', this.attr('x') + 10);
        }
    }, {
        keyCode: 38,
        fn: function(e) {
            this.attr('y', this.attr('y') - 10);
        }
    }, {
        keyCode: 37,
        fn: function(e) {
            this.attr('x', this.attr('x') - 10);
        }
    }, {
        keyCode: 40,
        fn: function(e) {
            this.attr('y', this.attr('y') + 10);
        }
    }]
});



const r1 = new p.shapes.Rectangle({
    pin: [50, 50],
    edge: [90, 120],
    fill: true,
    color: 'blue'
});

const r2 = new p.shapes.Rectangle({
    pin: [140, 50],
    edge: [120, 90],
    fill: true,
    color: 'orange',
    onClick: function(e) {
        this.animateTo({
            target: {
                width: clickFlag? 200: 120,
                height: clickFlag? 200: 90
            },
            duration: 500,
            timingFunction: 'easeOut'
        });
        clickFlag = !clickFlag;
    }
});



// const text1 = new p.shapes.Text({
//     pin: [r2.attr('x'), r2.attr('y') + 20],
//     content: 'PHENOM',
//     color: '#666',
//     fontSize: 20,
//     rotate: 45
// });


// const c1 = new p.shapes.Composite({
//     pin: [r2.attr('x'), r2.attr('y')],
//     shapes: [r2, text1],
//     center: r2.attr('center')
// });


// const g1 = new p.shapes.Group();


// p.append(r1);
// p.append(rr1);
// p.append(r2);

// const myAnimation = new p.animation({
//     value: [50, 300],
//     timingFunction: 'easeOutBounce',
//     render: function(v1) {
//         r1.attr('x', v1);
//     }
// });

// myAnimation
// .next({
//     value: [50, 300],
//     timingFunction: 'easeOutBounce',
//     render: function(v) {
//         r1.attr('y', v);
//     }
// }).next({
//     value: [300, 50],
//     timingFunction: 'easeOutBounce',
//     render: function(v) {
//         r1.attr('x', v);
//     }
// }).next({
//     value: [300, 50],
//     timingFunction: 'easeOutBounce',
//     render: function(v) {
//         r1.attr('y', v);
//     }
// }).loop();



// rr1.unbind('click');
// rr1.unbind('keypress', 39);



document.getElementById('btn').onclick = function() {
    for(let i = 0; i < 5; i++) {
        let circle = new p.shapes.Circle({
            pin: [0, 0],
            radius: 10,
            color: 'red'
        });

        p.append(circle);

        let motion = new p.motion(circle);

        motion.threshold(m => {
            if(m.pos.y >= p.getHeight() - 10) {
                m.pos.y = p.getHeight() - 10;
                m.vel.y *= -0.7;
            }
        }).threshold(m => {
            if(m.pos.y >= p.getHeight() - 10) {
                if(m.vel.x > 0.02) {
                    m.vel.x += -0.03;
                    m.pos.x += m.vel.x;
                }
                else {
                    m.vel.x = 0;
                    m.vel.y = 0;
                }
            }
        })
        .start([5*Math.random(), 0], [0, 0.4]);
    };
};











</script>
</body>
</html>